<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.5.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.5.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.5.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.5.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="最近研究了几天docker的快速部署，感觉很有新意，非常轻量级和方便，打算在公司推广一下，解放运维，省得每次部署一台新服务器都去跑安装脚本了，对于我们开发人员也是好事情，无需写太多重复的部署文档，直接将docker的images丢上服务器就可以运行了。 可能还有一些同学不了解docker这个项目，docker是一个快速部署的轻量级虚拟机项目，他允许开发人员将自己的程序的运行环境一起打包，制作成一个">
<meta name="keywords" content="node.js">
<meta property="og:type" content="article">
<meta property="og:title" content="利用docker快速部署应用">
<meta property="og:url" content="http://yoursite.com/2014/08/19/js-ajax/index.html">
<meta property="og:site_name" content="snoopyxdy的博客">
<meta property="og:description" content="最近研究了几天docker的快速部署，感觉很有新意，非常轻量级和方便，打算在公司推广一下，解放运维，省得每次部署一台新服务器都去跑安装脚本了，对于我们开发人员也是好事情，无需写太多重复的部署文档，直接将docker的images丢上服务器就可以运行了。 可能还有一些同学不了解docker这个项目，docker是一个快速部署的轻量级虚拟机项目，他允许开发人员将自己的程序的运行环境一起打包，制作成一个">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-11-26T03:48:18.881Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="利用docker快速部署应用">
<meta name="twitter:description" content="最近研究了几天docker的快速部署，感觉很有新意，非常轻量级和方便，打算在公司推广一下，解放运维，省得每次部署一台新服务器都去跑安装脚本了，对于我们开发人员也是好事情，无需写太多重复的部署文档，直接将docker的images丢上服务器就可以运行了。 可能还有一些同学不了解docker这个项目，docker是一个快速部署的轻量级虚拟机项目，他允许开发人员将自己的程序的运行环境一起打包，制作成一个">






  <link rel="canonical" href="http://yoursite.com/2014/08/19/js-ajax/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>利用docker快速部署应用 | snoopyxdy的博客</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">snoopyxdy的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">不要用执行上的勤奋来掩盖思考上的懒惰</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2014/08/19/js-ajax/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="snoopyxdy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="snoopyxdy的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">利用docker快速部署应用
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-08-19 15:42:29" itemprop="dateCreated datePublished" datetime="2014-08-19T15:42:29+08:00">2014-08-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-11-26 11:48:18" itemprop="dateModified" datetime="2018-11-26T11:48:18+08:00">2018-11-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/node-js/" itemprop="url" rel="index"><span itemprop="name">node.js</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/08/19/js-ajax/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count gitment-comments-count" data-xid="/2014/08/19/js-ajax/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>最近研究了几天docker的快速部署，感觉很有新意，非常轻量级和方便，打算在公司推广一下，解放运维，省得每次部署一台新服务器都去跑安装脚本了，对于我们开发人员也是好事情，无需写太多重复的部署文档，直接将docker的images丢上服务器就可以运行了。</p>
<p>可能还有一些同学不了解docker这个项目，docker是一个快速部署的轻量级虚拟机项目，他允许开发人员将自己的程序的运行环境一起打包，制作成一个docker的image（镜像），这样部署到服务器上，也只需要下载这个image就可以将程序跑起来，免去每次都安装各种依赖和环境的麻烦，还能够做到应用程序之间的隔离，因为我们公司部署的python程序，这样一来我也省去了每次都配置 vitualenv了。</p>
<a id="more"></a>
<p>官网地址：<a href="http://www.docker.com/" target="_blank" rel="noopener">http://www.docker.com/</a></p>
<p>一、安装：<br>安装很简单，直接进入下载页面，根据自己的操作系统下载相对应的安装包即可，下面说一下windows安装：</p>
<p>下载地址：<a href="https://docs.docker.com/installation/windows/" target="_blank" rel="noopener">https://docs.docker.com/installation/windows/</a></p>
<p>在安装docker时，会附带安装git和VirtualBox，所以可能安装时间稍微长一些，安装完毕重启系统，以管理员身份进入命令行，就可以使用进入linux虚拟机命令 “boot2docker” ，由于docker目前的镜像只针对linux，所以windows下面必须安装虚拟机才能使用。</p>
<p>第一次使用boot2docker start，会出现错误：</p>
<p>Failed to get machine “boot2docker-vm”: machine does not exist<br>没关系，这是因为没有boot2docker iso的镜像所致，执行：<br>boot2docker init<br>就可以初始化镜像，耐心等待下载并安装完毕后，我们继续执行开启虚拟机。<br>boot2docker start<br>在windows下是无法直接使用cmd窗口来操作linux系统的，所以我们需要进入linux虚拟机来操作docker，执行：<br>boot2docker ssh<br> 就可以进入linux虚拟机，如果要退出并关闭虚拟机，执行如下命令：<br>exit<br>boot2docker stop<br>调试时查看虚拟机ip地址，后面部署测试环境会用到：<br>boot2docker ip<br>192.168.59.103<br>我们可以通过ssh的ip地址192.168.59.103，用户名 docker，密码 tcuser，登录到虚拟机中去。<br>如果不幸长时间无法init成功，说明镜像被GFW挡住了，手动去github上下载镜像，地址为：<br><a href="https://github.com/boot2docker/boot2docker/releases" target="_blank" rel="noopener">https://github.com/boot2docker/boot2docker/releases</a><br>如果还是无法下载成功，我是好心人，把1.1.2版本的boot2docker.iso镜像丢到了百度云上：<br><a href="http://pan.baidu.com/s/1c01qieG" target="_blank" rel="noopener">http://pan.baidu.com/s/1c01qieG</a><br>下载完毕之后放到目录：<br>C:\Users\你的用户名.boot2docker\boot2docker.iso<br>然后再执行<br>$ boot2docker init</p>
<p>二、下载镜像，安装环境<br>我们先执行如下命令，启动虚拟机：<br>$ boot2docker start<br>2014/08/18 21:22:41 Waiting for VM to be started…<br>………..<br>2014/08/18 21:23:21 Started.<br>2014/08/18 21:23:21 Docker client does not run on Windows for now. Please use<br>2014/08/18 21:23:21     “boot2docker” ssh<br>2014/08/18 21:23:21 to SSH into the VM instead.<br>如果我们的物理机内存低于4G,那么跑这个boot2docker可能需要手动设置内存占用大小：<br>boot2docker start -m=512<br>我们利用命令就可以进入linux虚拟机了<br>$ boot2docker ssh </p>
<pre><code>                  ##        .
            ## ## ##       ==
         ## ## ## ##      ===
     /&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;\___/ ===
~~~ {~~ ~~~~ ~~~ ~~~~ ~~ ~ /  ===- ~~~
     \______ o          __/
       \    \        __/
        \____\______/
</code></pre><hr>
<p>| |<strong>   _</strong>   <strong>_ | |_|_</strong> \ <strong>| | _</strong>   <strong>_| | ___</strong> _ <strong><br>| ‘_ \ / _ \ / _ | </strong>| <strong>) / _` |/ _ \ / </strong>| |/ / _ \ ‘<strong>|<br>| |<em>) | (</em>) | (<em>) | |</em> / </strong>/ (<em>| | (</em>) | (<strong>|   &lt;  </strong>/ |<br>|_.<strong>/ _</strong>/ _<strong>/ \</strong>|<strong>_</strong>__,_|_<strong>/ _</strong>|_|____|_|<br>boot2docker: 1.1.2<br>master : 740106c - Thu Jul 24 03:24:10 UTC 2014<br>执行 docker 命令，会有一个命令列表，里面列出了所有 docker 支持的功能，列表如下：<br>Commands:<br>    attach    Attach to a running container<br>    build     Build an image from a Dockerfile<br>    commit    Create a new image from a container’s changes<br>    … …<br>下面会对一些常用的命令进行示例说明，我们可以通过如下命令，先查找centos的镜像，并把他下载下来<br>$ docker search centos #查找centos名字的镜像<br>$ docker pull centos #下载官方纯净版本的centos镜像<br>在调用search命令时，你会看到有好多centos包，他们都是这样的<username>/&lt;image_name&gt;，这些不在根目录的镜像都是非官方的，是其他用户提交到docker hub上去的，耐心等待片刻我们就可以将centos的镜像拉下来了。<br>如果脸黑，镜像又不幸被墙，那么试试加上下面的hosts：<br>54.234.135.251  get.docker.io<br>54.234.135.251  cdn-registry-1.docker.io<br>成功下载好centos镜像之后，我们可以利用如下命令来查看镜像列表：<br>docker images<br>REPOSITORY          TAG                 IMAGE ID            CREATED<br>VIRTUAL SIZE<br>centos              centos6             b1bd49907d55        2 weeks ago<br>212.5 MB<br>centos              centos7             b157b77b1a65        2 weeks ago<br>243.7 MB<br>centos              latest              b157b77b1a65        2 weeks ago<br>243.7 MB<br>接下来我们就利用centos7这个镜像输出一段 hello world<br>$ docker run b15 /bin/echo ‘Hello world’<br>Hello world</username></p>
<p>注意这里的 b15，他表示centos7这个images的id，不用全部打全，只要保证输入的id前几位能找到唯一镜像即可，这点很赞。<br>稍微复杂一点的例子：<br>docker run  -i -d -t b15 /bin/sh -c “while true; do echo hello world; sleep 1; done”<br>-i表示同步container的stdin，-t表示同步container的输出，-d表示deamon，以后台启动这个container，执行这个container是永远不会停止的，每一秒钟都会输出hello world。<br>至于什么是container，container和image的关系我们下一段再说。<br>列出镜像的历史：<br>$docker history image_name</p>
<p>三、安装环境<br>在开始第三段介绍之前，有必要说几个利用windows cmd窗口的小技巧。<br>1、如果想要使用标记选中功能，你会发现，当我们进入 boot2docker ssh 之后，鼠标对窗口的右键是无效的，所以想要利用标记选中窗口内的文字得这么弄：“点击左上角图标-&gt;编辑-&gt;标记”，这样就可以使用标记了<br>2、如果从其他地方复制了命令，但是窗口没有右键无法粘贴怎么办？用和1相同的办法：“点击左上角图标-&gt;编辑-&gt;粘贴”。<br>3、坑爹的windws如果命令太长，在boot2docker ssh里换行会错位的，在“点击左上角图标-&gt;属性-&gt;布局-&gt;屏幕缓冲区大小和窗口大小”的数值，保证长的命令也在一行内就没有问题了，注意要重启cmd窗口。<br> 接下来我们简单说明一下image和container的关系，image顾名思义就是镜像的意思，我们把他理解为一个执行环境（env），当我们执行了docker run命令之后，dock就会根据当前的image创建一个新的container，container更像是一个操作或者程序运行的一个沙箱，他们互相独立，但是都运行在image创建的执行环境之上，根据上一段我们执行了2个run的任务，也就创建了2个独立的container，我们通过命令<br>docker ps #查看当前运行的container<br>docker ps -a #查看所有的container<br>CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS                      PORTS               NAMES<br>d1eca89869d0        centos:centos7      /bin/sh -c ‘while tr   13 minutes ago      Exited (0) 7 minutes ago                        distracted_mcclintock<br>0b71024c8a95        centos:centos7      /bin/sh -c ‘while tr   15 minutes ago      Exited (0) 7 minutes ago                        pensive_meitner<br>79a488c9cfb6        centos:centos7      console                22 minutes ago                                                      sick_babbage<br>06f43c19d10a        centos:centos7      /bin/echo ‘Hello wor   25 minutes ago      Exited (0) 25 minutes ago                       berserk_einstein<br>我们可以分别利用命令对image和container进行删除<br>docker rm #删除container<br>docker rmi #删除image<br>docker rm <code>docker ps -a -q</code>  #删除所有容器<br>这样执行一次run就创建一个container，势必会造成大量的无用的container，可能我不需要持久化保存container，如果在docker run命令加上 –rm=true 选项，那当这个container执行完毕，将自动自己删除，保证了container数量不会泛滥增长。<br>我们之前下载纯净版centos7是没有任何第三方软件的，包括wget，ping等命令都要通过yum工具来重新安装，我们当然不想每次都重新安装这些东西，我不仅希望要把一些常用的库安装到的image中去，同时还希望把程序运行的环境也安装进去，所以image更像是一个系统的模版。<br>你会发现，当你执行如下命令，wget命令时安装成功了，但是当你下次执行wget命令时，又会报错，说找不到这个命令，到底是怎么回事呢？<br>docker run -t b15 yum install -y wget #通过yum工具安装wget命令</p>
<p>#安装完毕后，执行wget会报没有这个命令<br>$ docker run -t b15 wget <a href="http://www.baidu.com" target="_blank" rel="noopener">http://www.baidu.com</a><br>2014/08/18 15:42:19 exec: “wget”: executable file not found in $PATH<br>为什么会出现这个问题呢？答案就是我们上面所说的那样，每次执行docker run都会去独立的创建一个新的container来执行程序，所以我们必须手动把这些对container的更改提交成一个新的image，才能够依据这个image执行wget操作。<br>我们先把当前所有的container都删除，然后直接登录到container的bash命令窗口中去，免得每次都去输入docker run了<br>docker run -t -i b15 /bin/bash<br>bash-4.2#<br>这样我们进入了一个新的container，依据centos7作为模板，我们将要在其上面安装wget工具，直接执行<br>yum install -y wget<br>安装完毕之后，我们执行exit退出container<br>输入docker ps -a 我们找到刚才安装过wget工具的container ID，我们要把这个container重新做成一个新的image模版，这个模版将带wget命令。<br>docker ps -a<br>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES<br>26cc82ad29af        centos:centos7      /bin/bash           3 minutes ago       Exited (0) 5 seconds ago                       desperate_mccarthy</p>
<p>我们执行如下命令，将一个安装过软件的container提交为一个image<br>docker commit 26  wget-centos7<br>60cd26c6ca1e753bf77aa913ed7b826767a678b75f6dd8421353f6c0899d3e5e<br>我们查看当前image镜像的列表：<br>wget-centos7        latest              60cd26c6ca1e        37 seconds ago      304.6 MB<br>centos              centos6             b1bd49907d55        2 weeks ago         212.5 MB<br>centos              centos7             b157b77b1a65        2 weeks ago         243.7 MB<br>centos              latest              b157b77b1a65        2 weeks ago         243.7 MB<br>你会发现多了一行我们刚才提交的 wget-centos7 的image镜像记录，现在我们执行这个镜像的wget命令，看看会不会报错<br>docker run -t -i –rm=true 60 wget <a href="http://www.baidu.com" target="_blank" rel="noopener">http://www.baidu.com</a><br>–2014-08-18 15:54:55–  <a href="http://www.baidu.com/" target="_blank" rel="noopener">http://www.baidu.com/</a><br>Resolving <a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a> (<a href="http://www.baidu.com).." target="_blank" rel="noopener">www.baidu.com)..</a>. 180.97.33.108, 180.97.33.107<br>Connecting to <a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a> (<a href="http://www.baidu.com)|180.97.33.108|:80.." target="_blank" rel="noopener">www.baidu.com)|180.97.33.108|:80..</a>. connected.<br>HTTP request sent, awaiting response… 200 OK<br>执行完毕后，docker自动删除这个container，并且至今报错的wget命令无法找到也不会出错了。<br>第二种安装环境的办法，类似脚本安装，我们预先录入好一系列安装脚本，可以让docker帮我们依次执行这些安装脚本，然后生成image，例如有安装脚本Dockerfile：</p>
<h1 id="This-is-a-comment"><a href="#This-is-a-comment" class="headerlink" title="This is a comment"></a>This is a comment</h1><p>FROM centos<br>MAINTAINER doublespout <a href="mailto:&#100;&#x6f;&#x75;&#x62;&#x6c;&#x65;&#x73;&#x70;&#111;&#117;&#x74;&#64;&#x67;&#109;&#97;&#x69;&#108;&#x2e;&#99;&#111;&#109;" target="_blank" rel="noopener">&#100;&#x6f;&#x75;&#x62;&#x6c;&#x65;&#x73;&#x70;&#111;&#117;&#x74;&#64;&#x67;&#109;&#97;&#x69;&#108;&#x2e;&#99;&#111;&#109;</a><br>RUN yum install -y wget<br>我们执行如下命令进行创建images<br>mkdir wget<br>cd wget<br>vi Dockerfile #将上面内容复制进去<br>docker build -t=”doublespout/wget” ./</p>
<p>#将看到安装脚本的执行输出，安装完成后，执行 docker images 就可以看到我们刚才创建的镜像了<br>docker images<br>container 和 host 文件互相拷贝：<br>1、从container往host拷贝文件：<br>docker cp &lt;container_id&gt;:/root/hello.txt .<br>2、从host往container里拷贝文件，比较麻烦一点，首先停止Contaitner（当然不停止也能拷贝）<br>docker stop &lt;container_name_or_ID&gt;</p>
<p>然后执行拷贝操作，完成之后就可以在Contaitner里看到文件拉</p>
<p>#执行命令找到程序pid<br>ContainerID=$(docker inspect –format { {.Id} } &lt;container_name_or_ID&gt;)<br>cp /tmp/tmp.txt /var/lib/docker/aufs/mnt/<containerid>/tmp/</containerid></p>
<p>#centos在：</p>
<p>#/var/lib/docker/devicemapper/mnt/<containerid>/rootfs/<br>四、发布应用程序<br>我们根据上一段的步骤，手动将node.js环境装好container并且发布成image，并保存”app.js”文件到”/var/nodejs/app.js”，文件内容为：<br>var http = require(‘http’);<br>http.createServer(function (req, res) {<br>  res.writeHead(200, {‘Content-Type’: ‘text/plain’});<br>  res.end(‘Hello World\n’);<br>}).listen(1337); //注意这边不能和官网示例那样监听127.0.0.1<br>console.log(‘Server running at <a href="http://0.0.0.0:1337/&#39;)" target="_blank" rel="noopener">http://0.0.0.0:1337/&#39;)</a>;<br>执行如下命令，运行container：<br>docker run -d -i -p –name=nodeapp 1337:1337 fa node /var/nodejs/app.js<br>32bac9ed8ba055c935bd641d23097a36a573a243ee942358fd74dc4140308bc6<br>其中fa是我创建的镜像id，这个值因人而异，name参数是给这个container取名字，必须是唯一的。<br>-p参数就是类似端口映射的功能，将主机的端口1337映射到contianer的1337端口，我们可以运行 docker ps，查看正在运行的container，打开浏览器，就能够看到 hello world了<br>利用docker快速部署应用 - snoopyxdy - snoopyxdy的博客<br>用同样的方法就可以将我们开发好的应用快速部署到生产服务器上去了。如果在docker run命令需要设置cpu的支持数和权重值可以这样：<br> -c, –cpu-shares=0         CPU shares (relative weight)<br> –cpuset=””                CPUs in which to allow execution (0-3, 0,1)<br>另外一个小敲门，如果我想要进入一个在运行中的docker container时，可以使用 docker attach，连上这个container的输入和输出。<br>五、将多个 container 连接起来<br>我现在先下载一个redis数据库image，这也是以后做项目的常规用法，数据库单独用一个image，程序一个image，利用docker的link属性将他们连接起来。<br>docker pull redis #下载官方的redis镜像，耐心等待一段时间<br>接着我们执行命令启动redis镜像到一个container，开启redis-server持久化服务<br>docker run –name redis-server -d redis redis-server –appendonly yes<br>然后我们再启动一个redis镜像的container作为客户端连接它<br>docker run -it –link redis-server:redis –rm redis /bin/bash</containerid></p>
<p>redis@7441b8880e4e:/data$ env  #想要知道当前我们在主机还是container，注意$前面的host和name<br>REDIS_PORT_6379_TCP_PROTO=tcp<br>HOSTNAME=7441b8880e4e<br>TERM=xterm<br>REDIS_NAME=/boring_perlman/redis<br>REDIS_PORT_6379_TCP_ADDR=172.17.0.34    #redis服务器ip<br>REDIS_PORT_6379_TCP_PORT=6379                #redis服务器端口<br>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin<br>PWD=/data<br>REDIS_PORT_6379_TCP=tcp://172.17.0.34:6379<br>SHLVL=1<br>REDIS_PORT=tcp://172.17.0.34:6379<br>HOME=/<br>_=/usr/bin/env</p>
<p>$redis-cli -h “$REDIS_PORT_6379_TCP_ADDR” -p “$REDIS_PORT_6379_TCP_PORT”</p>
<p>172.17.0.34:6379&gt; set a 1 #成功连入redis数据库服务器<br>OK<br>172.17.0.34:6379&gt; get a<br>“1”<br>172.17.0.34:6379&gt;</p>
<p>通过这样的方法，我们就可以将发布的应用程序和数据库分开，单独进行管理，以后对数据库进行升级或者对程序进行调整两者都没有冲突，系统环境变量我们可以通过程序的os模块来获得。<br>六、文件卷标加载<br>比如我们想要一个日志文件保存目录，如果直接写入container，那样image升级之后，日志文件处理就比较麻烦了，所以就需要将主机的文件卷标挂载到container中去，挂载方法如下：<br>$ docker run –rm=true -i -t –name=ls-volume -v /etc/:/opt/etc/ centos ls /opt/etc<br>boot2docker  hostname     ld.so.conf     passwd-      securetty  sysconfig<br>default      hosts        mke2fs.conf    pcmcia       services   sysctl.conf<br>fstab        hosts.allow  modprobe.conf  profile      shadow     udev<br>group        hosts.deny   motd           profile.d    shadow-    version<br>group-       init.d       mtab           protocols    shells<br>gshadow      inittab      netconfig      rc.d         skel<br>gshadow-     issue        nsswitch.conf  resolv.conf  ssl<br>host.conf    ld.so.cache  passwd         rpc          sudoers<br>如果想要挂载后的文件是只读，需要在这样挂载：<br>-v /etc/:/opt/etc/:ro #read only<br>我们也可以挂载其他container中的文件系统，需要用到 -volumes-from 参数，我们先创建一个container，他共享/var/目录给其他container。<br>$ docker run -d -i -t -p 1337:1337 –name nodedev -v /var/ fa node /var/nodejs/app.js<br>然后我们启动一个ls-var的container来挂载nodedev共享的目录：</p>
<p>$ docker run –rm=true -i -t –volumes-from nodedev –name=aaa1 centos ls /var<br>adm    db     games   kerberos  local  log   nis     opt       run    tmp  yp<br>cache  empty  gopher  lib       lock   mail  nodejs  preserve  spool  var<br>我们打印var目录，会发现多了一个nodejs的目录，就是从nodedev中的container挂载过来的。其实我们挂载其他container的路径都是在根目录上的。</p>
<p>七、发布到docker hub上去</p>
<p>我们做完镜像，就需要将镜像发布到docker hub上，供服务器下载然后运行，这类似git仓库，将自己开发的东西丢到云服务器上，然后自己在其他机器或者其他开发者可以下载镜像，并且从这个镜像开始运行程序或者再进行2次制作镜像。</p>
<p>我们需要先登录docker帐号，执行：</p>
<p>$ docker login #输入你在docker官网注册的帐号和密码就可以登录了</p>
<p>$ docker push &lt;用户名&gt;/&lt;镜像名&gt; #将你制作的镜像提交到docker hub上<br>非官方不允许直接提交根目录镜像，所以必须以&lt;用户名&gt;/&lt;镜像名&gt;这样的方式提交，比如 doublespout/dev 这样</p>
<p>八、总结</p>
<p>docker快速部署介绍完毕了，总结一下，要创建一个简单项目使用的步骤：<br>1、安装配置docker<br>2、pull镜像，安装程序执行环境<br>3、pull数据库镜像<br>4、开发程序<br>5、push 程序的镜像<br>6、服务器安装配置docker<br>7、运行数据库镜像<br>8、运行程序镜像，并且把数据库镜像link进来，并且挂载主机的日志目录或其他上传目录。<br>使用了docker以后，环境配置只需一次，免去了开发部署一套，测试部署一套，生产又部署一套的麻烦，以后程序搬家也是非常简单。<br>最后分享一个小敲门，如何像使用linux虚拟机那样运行一个container，比如我我们想要直接登录container执行多个任务，又不想直接借助 docker run 命令，以后我们还想登录到这个container来查看运行情况，比如执行top，ps -aux命令等等。<br>docker run -d -i -t -p 1337:1337 fa /bin/bash<br>docker attach 58<br>bash-4.2#<br>这样我们就可以通过进入container来调试程序了。但是一旦执行ctrl+d或者exit，container就将退出，这个方法也只适用于开发调试的时候。<br>最后请跳出 container 是一个小的vps的概念，详见另一篇文章，<br>不要用ssh连接到你的container</p>
<p>最后提醒下windows用户，还是建议使用vmware安装centos7的镜像然后使用docker，原因有2：<br>1、boot2docker的vitrulbox虚拟机有内存泄漏，在低内存机器，比如我这个4G内容的机子上会很卡<br>2、boot2docker一旦重启虚拟机会把所有磁盘文件reset，所以还是用vmware靠谱</p>

      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/node-js/" rel="tag"># node.js</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2014/08/14/js-ajax/" rel="next" title="mongoose中使用aggregation进行group分组功能">
                <i class="fa fa-chevron-left"></i> mongoose中使用aggregation进行group分组功能
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2014/08/20/js-ajax/" rel="prev" title="使用docker，不要用ssh连接到你的container">
                使用docker，不要用ssh连接到你的container <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      
        <div id="gitment-container"></div>
      
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">snoopyxdy</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">284</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">分类</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#This-is-a-comment"><span class="nav-number">1.</span> <span class="nav-text">This is a comment</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">snoopyxdy</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v6.5.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.5.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.5.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.5.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.5.0"></script>



  



  






<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="http://wzhfile.static.xytang88.com/gitmint.browser.js?v=2"></script>
    
<!-- END LOCAL -->

    
      <style>
        a.gitment-editor-footer-tip { display: none; }
        .gitment-container.gitment-footer-container { display: none; }
      </style>
    

    
      <script type="text/javascript">
      function renderGitment(){
        var gitment = new Gitmint({
            id: window.location.pathname,
            owner: 'DoubleSpout',
            repo: 'dsblog',
            
            lang: "" || navigator.language || navigator.systemLanguage || navigator.userLanguage,
            
            oauth: {
            
            
                client_secret: '202e5bcda8eacf79e44b6261326de2e79eff846e',
            
                client_id: '7d56dc5e01e83a1a44bb'
            }});
        gitment.render('gitment-container');
      }

      
      renderGitment();
      
      </script>
    






  





  

  

  

  

  

  
  

  

  

  

  

  

  

</body>
</html>
