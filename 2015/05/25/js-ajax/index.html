<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.5.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.5.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.5.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.5.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="docker搭建本地私有仓库，将常用镜像丢到私有仓库，可以加速下载，万一docker hub被墙，还能为docker提供服务。1、下载 registry 镜像docker pull registry2、编写 registry的配置文件说明如下：">
<meta name="keywords" content="node.js">
<meta property="og:type" content="article">
<meta property="og:title" content="docker搭建私有hub仓库">
<meta property="og:url" content="http://yoursite.com/2015/05/25/js-ajax/index.html">
<meta property="og:site_name" content="snoopyxdy的博客">
<meta property="og:description" content="docker搭建本地私有仓库，将常用镜像丢到私有仓库，可以加速下载，万一docker hub被墙，还能为docker提供服务。1、下载 registry 镜像docker pull registry2、编写 registry的配置文件说明如下：">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-11-26T03:48:18.855Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="docker搭建私有hub仓库">
<meta name="twitter:description" content="docker搭建本地私有仓库，将常用镜像丢到私有仓库，可以加速下载，万一docker hub被墙，还能为docker提供服务。1、下载 registry 镜像docker pull registry2、编写 registry的配置文件说明如下：">






  <link rel="canonical" href="http://yoursite.com/2015/05/25/js-ajax/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>docker搭建私有hub仓库 | snoopyxdy的博客</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">snoopyxdy的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">不要用执行上的勤奋来掩盖思考上的懒惰</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/05/25/js-ajax/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="snoopyxdy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="snoopyxdy的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">docker搭建私有hub仓库
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2015-05-25 17:22:59" itemprop="dateCreated datePublished" datetime="2015-05-25T17:22:59+08:00">2015-05-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-11-26 11:48:18" itemprop="dateModified" datetime="2018-11-26T11:48:18+08:00">2018-11-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/node-js/" itemprop="url" rel="index"><span itemprop="name">node.js</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/05/25/js-ajax/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count gitment-comments-count" data-xid="/2015/05/25/js-ajax/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>docker搭建本地私有仓库，将常用镜像丢到私有仓库，可以加速下载，万一docker hub被墙，还能为docker提供服务。<br>1、下载 registry 镜像<br>docker pull registry<br>2、编写 registry的配置文件说明如下：</p>
<a id="more"></a>
<p>docker搭建本地私有仓库，将常用镜像丢到私有仓库，可以加速下载，万一docker hub被墙，还能为docker提供服务。<br>1、下载 registry 镜像<br>docker pull registry<br>2、编写 registry的配置文件说明如下：</p>
<p>官方文档上说，支持多种口味的配置文件，所谓多种口味是指启动的时候通过设置 不同的环境变量：</p>
<p>SETTINGS_FLAVOR = xxxx  来确定，使用配置文件的哪个？</p>
<p>&lt;&lt;: *common  表示从哪种口味继承</p>
<p>我们现在搭建一个基于本地文件存储的 docker hub。</p>
<h1 id="All-other-flavors-inherit-the-common’-config-snippet"><a href="#All-other-flavors-inherit-the-common’-config-snippet" class="headerlink" title="All other flavors inherit the `common’ config snippet"></a>All other flavors inherit the `common’ config snippet</h1><p>common: &amp;common<br>    issue: ‘“docker-registry server”‘</p>
<pre><code># Default log level is info
loglevel: _env:LOGLEVEL:info
# Enable debugging (additional informations in the output of the _ping endpoint)
debug: _env:DEBUG:false
# By default, the registry acts standalone (eg: doesn&apos;t query the index)
standalone: _env:STANDALONE:true
# The default endpoint to use (if NOT standalone) is index.docker.io
index_endpoint: _env:INDEX_ENDPOINT:https://index.docker.io
# Storage redirect is disabled
storage_redirect: _env:STORAGE_REDIRECT
# Token auth is enabled (if NOT standalone)
disable_token_auth: _env:DISABLE_TOKEN_AUTH
# No priv key
privileged_key: _env:PRIVILEGED_KEY
# No search backend
search_backend: _env:SEARCH_BACKEND
# SQLite search backend
sqlalchemy_index_database: _env:SQLALCHEMY_INDEX_DATABASE:sqlite:////data/docker_hub/docker-registry.db

# Mirroring is not enabled
mirroring:
    source: _env:MIRROR_SOURCE # https://registry-1.docker.io
    source_index: _env:MIRROR_SOURCE_INDEX # https://index.docker.io
    tags_cache_ttl: _env:MIRROR_TAGS_CACHE_TTL:172800 # seconds

cache:
    host: _env:CACHE_REDIS_HOST
    port: _env:CACHE_REDIS_PORT
    db: _env:CACHE_REDIS_DB:0
    password: _env:CACHE_REDIS_PASSWORD

# Enabling LRU cache for small files
# This speeds up read/write on small files
# when using a remote storage backend (like S3).
cache_lru:
    host: _env:CACHE_LRU_REDIS_HOST
    port: _env:CACHE_LRU_REDIS_PORT
    db: _env:CACHE_LRU_REDIS_DB:0
    password: _env:CACHE_LRU_REDIS_PASSWORD

# Enabling these options makes the Registry send an email on each code Exception
email_exceptions:
    smtp_host: _env:SMTP_HOST
    smtp_port: _env:SMTP_PORT:25
    smtp_login: _env:SMTP_LOGIN
    smtp_password: _env:SMTP_PASSWORD
    smtp_secure: _env:SMTP_SECURE:false
    from_addr: _env:SMTP_FROM_ADDR:docker-registry@localdomain.local
    to_addr: _env:SMTP_TO_ADDR:noise+dockerregistry@localdomain.local

# Enable bugsnag (set the API key)
bugsnag: _env:BUGSNAG

# CORS support is not enabled by default
cors:
    origins: _env:CORS_ORIGINS
    methods: _env:CORS_METHODS
    headers: _env:CORS_HEADERS:[Content-Type]
    expose_headers: _env:CORS_EXPOSE_HEADERS
    supports_credentials: _env:CORS_SUPPORTS_CREDENTIALS
    max_age: _env:CORS_MAX_AGE
    send_wildcard: _env:CORS_SEND_WILDCARD
    always_send: _env:CORS_ALWAYS_SEND
    automatic_options: _env:CORS_AUTOMATIC_OPTIONS
    vary_header: _env:CORS_VARY_HEADER
    resources: _env:CORS_RESOURCES
</code></pre><p>local: &amp;local<br>    &lt;&lt;: *common<br>    storage: local<br>    storage_path: _env:STORAGE_PATH:/data/docker_hub</p>
<p>s3: &amp;s3<br>    &lt;&lt;: *common<br>    storage: s3<br>    s3_region: _env:AWS_REGION<br>    s3_bucket: _env:AWS_BUCKET<br>    boto_bucket: _env:AWS_BUCKET<br>    storage_path: _env:STORAGE_PATH:/registry<br>    s3_encrypt: _env:AWS_ENCRYPT:true<br>    s3_secure: _env:AWS_SECURE:true<br>    s3_access_key: _env:AWS_KEY<br>    s3_secret_key: _env:AWS_SECRET<br>    s3_use_sigv4: _env:AWS_USE_SIGV4<br>    boto_host: _env:AWS_HOST<br>    boto_port: _env:AWS_PORT<br>    boto_calling_format: _env:AWS_CALLING_FORMAT</p>
<p>cloudfronts3: &amp;cloudfronts3<br>    &lt;&lt;: *s3<br>    cloudfront:<br>        base: _env:CF_BASE_URL<br>        keyid: _env:CF_KEYID<br>        keysecret: _env:CF_KEYSECRET</p>
<p>azureblob: &amp;azureblob<br>    &lt;&lt;: *common<br>    storage: azureblob<br>    azure_storage_account_name: _env:AZURE_STORAGE_ACCOUNT_NAME<br>    azure_storage_account_key: _env:AZURE_STORAGE_ACCOUNT_KEY<br>    azure_storage_container: _env:AZURE_STORAGE_CONTAINER:registry<br>    azure_use_https: _env:AZURE_USE_HTTPS:true</p>
<h1 id="Ceph-Object-Gateway-Configuration"><a href="#Ceph-Object-Gateway-Configuration" class="headerlink" title="Ceph Object Gateway Configuration"></a>Ceph Object Gateway Configuration</h1><h1 id="See-http-ceph-com-docs-master-radosgw-for-details-on-installing-this-service"><a href="#See-http-ceph-com-docs-master-radosgw-for-details-on-installing-this-service" class="headerlink" title="See http://ceph.com/docs/master/radosgw/ for details on installing this service."></a>See <a href="http://ceph.com/docs/master/radosgw/" target="_blank" rel="noopener">http://ceph.com/docs/master/radosgw/</a> for details on installing this service.</h1><p>ceph-s3: &amp;ceph-s3<br>    &lt;&lt;: *common<br>    storage: s3<br>    s3_region: ~<br>    s3_bucket: _env:AWS_BUCKET<br>    s3_encrypt: _env:AWS_ENCRYPT:false<br>    s3_secure: _env:AWS_SECURE:false<br>    storage_path: _env:STORAGE_PATH:/registry<br>    s3_access_key: _env:AWS_KEY<br>    s3_secret_key: _env:AWS_SECRET<br>    boto_bucket: _env:AWS_BUCKET<br>    boto_host: _env:AWS_HOST<br>    boto_port: _env:AWS_PORT<br>    boto_debug: _env:AWS_DEBUG:0<br>    boto_calling_format: _env:AWS_CALLING_FORMAT</p>
<h1 id="Google-Cloud-Storage-Configuration"><a href="#Google-Cloud-Storage-Configuration" class="headerlink" title="Google Cloud Storage Configuration"></a>Google Cloud Storage Configuration</h1><h1 id="See"><a href="#See" class="headerlink" title="See:"></a>See:</h1><h1 id="https-developers-google-com-storage-docs-reference-v1-getting-startedv1-keys"><a href="#https-developers-google-com-storage-docs-reference-v1-getting-startedv1-keys" class="headerlink" title="https://developers.google.com/storage/docs/reference/v1/getting-startedv1#keys"></a><a href="https://developers.google.com/storage/docs/reference/v1/getting-startedv1#keys" target="_blank" rel="noopener">https://developers.google.com/storage/docs/reference/v1/getting-startedv1#keys</a></h1><h1 id="for-details-on-access-and-secret-keys"><a href="#for-details-on-access-and-secret-keys" class="headerlink" title="for details on access and secret keys."></a>for details on access and secret keys.</h1><p>gcs:<br>    &lt;&lt;: *common<br>    storage: gcs<br>    boto_bucket: _env:GCS_BUCKET<br>    storage_path: _env:STORAGE_PATH:/registry<br>    gs_secure: _env:GCS_SECURE:true<br>    gs_access_key: _env:GCS_KEY<br>    gs_secret_key: _env:GCS_SECRET</p>
<pre><code># OAuth 2.0 authentication with the storage.
# oauth2 can be set to true or false. If it is set to true, gs_access_key,
# gs_secret_key and gs_secure are not needed.
# Client ID and Client Secret must be set into OAUTH2_CLIENT_ID and
# OAUTH2_CLIENT_SECRET environment variables.
# See: https://developers.google.com/accounts/docs/OAuth2.
oauth2: _env:GCS_OAUTH2:false
</code></pre><h1 id="This-flavor-is-for-storing-images-in-Openstack-Swift"><a href="#This-flavor-is-for-storing-images-in-Openstack-Swift" class="headerlink" title="This flavor is for storing images in Openstack Swift"></a>This flavor is for storing images in Openstack Swift</h1><p>swift: &amp;swift<br>    &lt;&lt;: *common<br>    storage: swift<br>    storage_path: _env:STORAGE_PATH:/registry</p>
<pre><code># keystone authorization
swift_authurl: _env:OS_AUTH_URL
swift_container: _env:OS_CONTAINER
swift_user: _env:OS_USERNAME
swift_password: _env:OS_PASSWORD
swift_tenant_name: _env:OS_TENANT_NAME
swift_region_name: _env:OS_REGION_NAME
</code></pre><h1 id="This-flavor-stores-the-images-in-Glance-to-integrate-with-openstack"><a href="#This-flavor-stores-the-images-in-Glance-to-integrate-with-openstack" class="headerlink" title="This flavor stores the images in Glance (to integrate with openstack)"></a>This flavor stores the images in Glance (to integrate with openstack)</h1><h1 id="See-also-https-github-com-docker-openstack-docker"><a href="#See-also-https-github-com-docker-openstack-docker" class="headerlink" title="See also: https://github.com/docker/openstack-docker"></a>See also: <a href="https://github.com/docker/openstack-docker" target="_blank" rel="noopener">https://github.com/docker/openstack-docker</a></h1><p>glance: &amp;glance<br>    &lt;&lt;: *common<br>    storage: glance<br>    storage_alternate: _env:GLANCE_STORAGE_ALTERNATE:file<br>    storage_path: _env:STORAGE_PATH:/tmp/registry</p>
<p>openstack:<br>    &lt;&lt;: *glance</p>
<h1 id="This-flavor-stores-the-images-in-Glance-to-integrate-with-openstack-1"><a href="#This-flavor-stores-the-images-in-Glance-to-integrate-with-openstack-1" class="headerlink" title="This flavor stores the images in Glance (to integrate with openstack)"></a>This flavor stores the images in Glance (to integrate with openstack)</h1><h1 id="and-tags-in-Swift"><a href="#and-tags-in-Swift" class="headerlink" title="and tags in Swift."></a>and tags in Swift.</h1><p>glance-swift: &amp;glance-swift<br>    &lt;&lt;: *swift<br>    storage: glance<br>    storage_alternate: swift</p>
<p>openstack-swift:<br>    &lt;&lt;: *glance-swift</p>
<p>elliptics:<br>    &lt;&lt;: *common<br>    storage: elliptics<br>    elliptics_nodes: _env:ELLIPTICS_NODES<br>    elliptics_wait_timeout: _env:ELLIPTICS_WAIT_TIMEOUT:60<br>    elliptics_check_timeout: _env:ELLIPTICS_CHECK_TIMEOUT:60<br>    elliptics_io_thread_num: _env:ELLIPTICS_IO_THREAD_NUM:2<br>    elliptics_net_thread_num: _env:ELLIPTICS_NET_THREAD_NUM:2<br>    elliptics_nonblocking_io_thread_num: _env:ELLIPTICS_NONBLOCKING_IO_THREAD_NUM:2<br>    elliptics_groups: _env:ELLIPTICS_GROUPS<br>    elliptics_verbosity: _env:ELLIPTICS_VERBOSITY:4<br>    elliptics_logfile: _env:ELLIPTICS_LOGFILE:/dev/stderr<br>    elliptics_addr_family: _env:ELLIPTICS_ADDR_FAMILY:2</p>
<h1 id="This-flavor-stores-the-images-in-Aliyun-OSS"><a href="#This-flavor-stores-the-images-in-Aliyun-OSS" class="headerlink" title="This flavor stores the images in Aliyun OSS"></a>This flavor stores the images in Aliyun OSS</h1><h1 id="See-1"><a href="#See-1" class="headerlink" title="See:"></a>See:</h1><h1 id="https-i-aliyun-com-access-key"><a href="#https-i-aliyun-com-access-key" class="headerlink" title="https://i.aliyun.com/access_key/"></a><a href="https://i.aliyun.com/access_key/" target="_blank" rel="noopener">https://i.aliyun.com/access_key/</a></h1><h1 id="for-details-on-access-and-secret-keys-1"><a href="#for-details-on-access-and-secret-keys-1" class="headerlink" title="for details on access and secret keys."></a>for details on access and secret keys.</h1><p>oss: &amp;oss<br>    &lt;&lt;: *common<br>    storage: oss<br>    storage_path: _env:STORAGE_PATH:/registry/<br>    oss_host: _env:OSS_HOST<br>    oss_bucket: _env:OSS_BUCKET<br>    oss_accessid: _env:OSS_KEY<br>    oss_accesskey: _env:OSS_SECRET</p>
<h1 id="This-is-the-default-configuration-when-no-flavor-is-specified"><a href="#This-is-the-default-configuration-when-no-flavor-is-specified" class="headerlink" title="This is the default configuration when no flavor is specified"></a>This is the default configuration when no flavor is specified</h1><p>dev: &amp;dev<br>    &lt;&lt;: *local<br>    loglevel: _env:LOGLEVEL:debug<br>    debug: _env:DEBUG:true<br>    search_backend: _env:SEARCH_BACKEND:sqlalchemy</p>
<h1 id="This-flavor-is-used-by-unit-tests"><a href="#This-flavor-is-used-by-unit-tests" class="headerlink" title="This flavor is used by unit tests"></a>This flavor is used by unit tests</h1><p>test:<br>    &lt;&lt;: *dev<br>    index_endpoint: <a href="https://registry-stage.hub.docker.com" target="_blank" rel="noopener">https://registry-stage.hub.docker.com</a><br>    standalone: true<br>    storage_path: _env:STORAGE_PATH:./tmp/test</p>
<h1 id="To-specify-another-flavor-set-the-environment-variable-SETTINGS-FLAVOR"><a href="#To-specify-another-flavor-set-the-environment-variable-SETTINGS-FLAVOR" class="headerlink" title="To specify another flavor, set the environment variable SETTINGS_FLAVOR"></a>To specify another flavor, set the environment variable SETTINGS_FLAVOR</h1><h1 id="export-SETTINGS-FLAVOR-prod"><a href="#export-SETTINGS-FLAVOR-prod" class="headerlink" title="$ export SETTINGS_FLAVOR=prod"></a>$ export SETTINGS_FLAVOR=prod</h1><p>prod:<br>    &lt;&lt;: *s3<br>    storage_path: _env:STORAGE_PATH:/prod</p>
<p>3、启动服务<br>创建文件夹：<br>mkdir  /data/docker_hub<br>创建配置文件：<br>vi docker_registry.yml<br>然后我们启动registry，由于本地hub，我们就不开启认证了<br>sudo docker run -d -p 0.0.0.0:5000:5000 -v /usr/local:/registry-conf -v /data/docker_hub:/data/docker_hub -e DOCKER_REGISTRY_CONFIG=/registry-conf/docker_registry.yml -e SETTINGS_FLAVOR=local -e SEARCH_BACKEND=sqlalchemy registry </p>
<p>执行docker ps，发现我们的registry服务已经启动了。<br>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES<br>04522945dd1e        registry:latest     “docker-registry”   4 seconds ago       Up 2 seconds        0.0.0.0:5000-&gt;5000/tcp   fervent_euclid      </p>
<p>4、尝试上传镜像到私有hub<br>先执行  docker images 查看已经有的镜像：<br>REPOSITORY   TAG       IMAGE ID        CREATED          VIRTUAL SIZE<br>redis      2.8.19    8c37ff647cf2      4 weeks ago      110.7 MB</p>
<p>使用docker tag 将 8c37ff647cf2  这个镜像标记为 10.14.40.112:5000/tc-redis（格式为 docker tag IMAGE[:TAG] [REGISTRYHOST/][USERNAME/]NAME[:TAG]）。<br>docker tag 8c37ff647cf2  10.14.40.112:5000/tc-redis</p>
<p>然后我们把镜像推送到私有hub中<br>docker push 10.14.40.112:5000/tc-redis</p>
<p>如果出现 insecure 错误，修改 vi /etc/rc.d/init.d/docker 文件，加上启动命令如下：<br>$exec -d $other_args –insecure-registry 10.14.40.112:5000 $DOCKER_STORAGE_OPTIONS &amp;&gt;&gt; $logfile &amp;</p>
<p>5、拉取镜像</p>
<p>我们把本地的 tc-redis 删除，然后尝试从本地私有仓库拉取镜像</p>
<p> docker rmi -f 8c37ff647cf2<br>然后我们从私有仓库拉取镜像</p>
<p>docker pull 10.14.40.112:5000/tc-redis</p>
<p>然后执行 docker images 查看镜像：</p>
<p>REPOSITORY    TAG       IMAGE ID     CREATED         VIRTUAL SIZE<br>10.14.40.112:5000/tc-redis  latest  8c37ff647cf2  4 weeks ago  110.7 MB</p>
<p>5、搜索镜像：</p>
<p>curl <a href="http://10.14.40.112:5000/v1/search?q=tc" target="_blank" rel="noopener">http://10.14.40.112:5000/v1/search?q=tc</a><br>{“num_results”: 1, “query”: “”, “results”: [{“description”: null, “name”: “library/tc-redis”}]}<br>至此我们一个简单的 docker 私有hub搭建完毕</p>
<p>docker-registry私有仓库项目主页<a href="https://github.com/docker/docker-registry" target="_blank" rel="noopener">https://github.com/docker/docker-registry</a></p>

      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/node-js/" rel="tag"># node.js</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/05/20/js-ajax/" rel="next" title="关于Mongodb索引实战">
                <i class="fa fa-chevron-left"></i> 关于Mongodb索引实战
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/05/26/js-ajax/" rel="prev" title="基于 Swarm 和 dockerui 的 docker 搭建docker简单集群管理系统">
                基于 Swarm 和 dockerui 的 docker 搭建docker简单集群管理系统 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      
        <div id="gitment-container"></div>
      
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">snoopyxdy</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">284</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">分类</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#All-other-flavors-inherit-the-common’-config-snippet"><span class="nav-number">1.</span> <span class="nav-text">All other flavors inherit the `common’ config snippet</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ceph-Object-Gateway-Configuration"><span class="nav-number">2.</span> <span class="nav-text">Ceph Object Gateway Configuration</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#See-http-ceph-com-docs-master-radosgw-for-details-on-installing-this-service"><span class="nav-number">3.</span> <span class="nav-text">See http://ceph.com/docs/master/radosgw/ for details on installing this service.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Google-Cloud-Storage-Configuration"><span class="nav-number">4.</span> <span class="nav-text">Google Cloud Storage Configuration</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#See"><span class="nav-number">5.</span> <span class="nav-text">See:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#https-developers-google-com-storage-docs-reference-v1-getting-startedv1-keys"><span class="nav-number">6.</span> <span class="nav-text">https://developers.google.com/storage/docs/reference/v1/getting-startedv1#keys</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#for-details-on-access-and-secret-keys"><span class="nav-number">7.</span> <span class="nav-text">for details on access and secret keys.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#This-flavor-is-for-storing-images-in-Openstack-Swift"><span class="nav-number">8.</span> <span class="nav-text">This flavor is for storing images in Openstack Swift</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#This-flavor-stores-the-images-in-Glance-to-integrate-with-openstack"><span class="nav-number">9.</span> <span class="nav-text">This flavor stores the images in Glance (to integrate with openstack)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#See-also-https-github-com-docker-openstack-docker"><span class="nav-number">10.</span> <span class="nav-text">See also: https://github.com/docker/openstack-docker</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#This-flavor-stores-the-images-in-Glance-to-integrate-with-openstack-1"><span class="nav-number">11.</span> <span class="nav-text">This flavor stores the images in Glance (to integrate with openstack)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#and-tags-in-Swift"><span class="nav-number">12.</span> <span class="nav-text">and tags in Swift.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#This-flavor-stores-the-images-in-Aliyun-OSS"><span class="nav-number">13.</span> <span class="nav-text">This flavor stores the images in Aliyun OSS</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#See-1"><span class="nav-number">14.</span> <span class="nav-text">See:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#https-i-aliyun-com-access-key"><span class="nav-number">15.</span> <span class="nav-text">https://i.aliyun.com/access_key/</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#for-details-on-access-and-secret-keys-1"><span class="nav-number">16.</span> <span class="nav-text">for details on access and secret keys.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#This-is-the-default-configuration-when-no-flavor-is-specified"><span class="nav-number">17.</span> <span class="nav-text">This is the default configuration when no flavor is specified</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#This-flavor-is-used-by-unit-tests"><span class="nav-number">18.</span> <span class="nav-text">This flavor is used by unit tests</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#To-specify-another-flavor-set-the-environment-variable-SETTINGS-FLAVOR"><span class="nav-number">19.</span> <span class="nav-text">To specify another flavor, set the environment variable SETTINGS_FLAVOR</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#export-SETTINGS-FLAVOR-prod"><span class="nav-number">20.</span> <span class="nav-text">$ export SETTINGS_FLAVOR=prod</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">snoopyxdy</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v6.5.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.5.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.5.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.5.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.5.0"></script>



  



  






<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="http://wzhfile.static.xytang88.com/gitmint.browser.js?v=3"></script>
    
<!-- END LOCAL -->

    
      <style>
        a.gitment-editor-footer-tip { display: none; }
        .gitment-container.gitment-footer-container { display: none; }
      </style>
    

    
      <script type="text/javascript">
      function renderGitment(){
        var gitment = new Gitmint({
            id: window.location.pathname,
            owner: 'DoubleSpout',
            repo: 'dsblog',
            
            lang: "" || navigator.language || navigator.systemLanguage || navigator.userLanguage,
            
            oauth: {
            
            
                client_secret: '202e5bcda8eacf79e44b6261326de2e79eff846e',
            
                client_id: '7d56dc5e01e83a1a44bb'
            }});
        gitment.render('gitment-container');
      }

      
      renderGitment();
      
      </script>
    






  





  

  

  

  

  

  
  

  

  

  

  

  

  

</body>
</html>
