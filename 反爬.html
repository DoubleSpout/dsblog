<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.5.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.5.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.5.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.5.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="最近接到做攻破一个反爬项目的任务，对手是xlong.com的反爬技术，于是着手准备攻破这个反爬系统。">
<meta name="keywords" content="node.js">
<meta property="og:type" content="website">
<meta property="og:title" content="实战-突破x龙反扒技术">
<meta property="og:url" content="http://yoursite.com/反爬.html">
<meta property="og:site_name" content="snoopyxdy的博客">
<meta property="og:description" content="最近接到做攻破一个反爬项目的任务，对手是xlong.com的反爬技术，于是着手准备攻破这个反爬系统。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-11-26T03:48:18.998Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="实战-突破x龙反扒技术">
<meta name="twitter:description" content="最近接到做攻破一个反爬项目的任务，对手是xlong.com的反爬技术，于是着手准备攻破这个反爬系统。">






  <link rel="canonical" href="http://yoursite.com/反爬.html">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>实战-突破x龙反扒技术 | snoopyxdy的博客</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">snoopyxdy的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">不要用执行上的勤奋来掩盖思考上的懒惰</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  
    

    
    
      
      
    
      
      
    
    

  


  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    
    
    
    <div class="post-block page">
      <header class="post-header">

<h1 class="post-title" itemprop="name headline">实战-突破x龙反扒技术</h1>

<div class="post-meta">
  
  



</div>

</header>

      
      
      
      <div class="post-body">
        
        
          <p>最近接到做攻破一个反爬项目的任务，对手是<code>xlong.com</code>的反爬技术，于是着手准备攻破这个反爬系统。</p>
<a id="more"></a>
<p>反爬一般都是利用前端的js的sdk来混淆、哈希或加解密某一个code，爬虫想要爬取数据一般分两种方式，今天我都会进行实战的分析和详细攻破过程。一般所有网站的<code>PC</code>站都是戒备最森严，同时也是爬虫最泛滥的地方，所以我们就以爬取x龙<code>PC</code>站为实例，看看我们是如何一步步抽丝剥茧，破解掉x龙的防爬系统的。</p>
<h2 id="使用seleium来直接抓取"><a href="#使用seleium来直接抓取" class="headerlink" title="使用seleium来直接抓取"></a>使用seleium来直接抓取</h2><p>这种方式是比较直接和粗暴的，虽然效率会比第二种低一些，但是不需要破解过程，破解成本低，就看抓取任务是否需要长效的抓取，如果只是抓一下玩玩，或者测试一下，使用seleium粗暴的抓取是很好的方式。</p>
<p>我们利用python直接跑seleium的chromuin来加载酒店详细页，然后利用seleium的webdriver的jsapi抓取dom元素，就可以很轻松的抓取到酒店的详细价格了，相关python代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line">HOTEL_ID = [<span class="string">'30101020'</span>, <span class="string">'40101215'</span>,<span class="string">'50101624'</span>, <span class="string">'00101859'</span>,<span class="string">'50101566'</span>, <span class="string">'30101035'</span>,<span class="string">'40101107'</span>, <span class="string">'92771974'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(str=<span class="string">''</span>)</span>:</span></span><br><span class="line">    hl = hashlib.md5()</span><br><span class="line">    hl.update(str.encode(encoding=<span class="string">'utf-8'</span>))</span><br><span class="line">    <span class="keyword">return</span> hl.hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">createUa</span><span class="params">()</span>:</span></span><br><span class="line">    s0 = numpy.random.randint(<span class="number">100</span>,<span class="number">537</span>)</span><br><span class="line">    s1 = numpy.random.randint(<span class="number">10</span>,<span class="number">36</span>)</span><br><span class="line">    s2 = numpy.random.randint(<span class="number">55</span>,<span class="number">67</span>)</span><br><span class="line">    s3 = numpy.random.randint(<span class="number">3000</span>,<span class="number">3396</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/&#123;0&#125;.&#123;1&#125; (KHTML, like Gecko) Chrome/&#123;2&#125;.0.&#123;3&#125;.79 Safari/537.36'</span>.format(</span><br><span class="line">        s0,s1,s2,s3</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trans</span><span class="params">(jsonData,hotelId)</span>:</span></span><br><span class="line">    csvfile = open(<span class="string">'elonghotel_'</span>+ hotelId +<span class="string">'.csv'</span>, <span class="string">'wb+'</span>) <span class="comment"># python3下</span></span><br><span class="line">    writer = csv.writer(csvfile)</span><br><span class="line">    flag = <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">for</span> dic <span class="keyword">in</span> jsonData:</span><br><span class="line">        <span class="keyword">if</span> flag:</span><br><span class="line">            <span class="comment"># 获取属性列表</span></span><br><span class="line">            keys = list(dic.keys())</span><br><span class="line">            <span class="keyword">print</span> (keys)</span><br><span class="line">            writer.writerow(keys) <span class="comment"># 将属性列表写入csv中</span></span><br><span class="line">            flag = <span class="keyword">False</span></span><br><span class="line">        <span class="comment"># 读取json数据的每一行，将values数据一次一行的写入csv中</span></span><br><span class="line">        writer.writerow(list(dic.values()))</span><br><span class="line">    csvfile.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">createDateCookie</span><span class="params">(curStr, nextStr)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> curStr:</span><br><span class="line">        curStr = (datetime.datetime.now()).strftime(<span class="string">'%Y-%m-%d'</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> nextStr:</span><br><span class="line">        nextStr = (datetime.datetime.now() + datetime.timedelta(days=<span class="number">1</span>)).strftime(<span class="string">'%Y-%m-%d'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'OutDate=&#123;0&#125;&amp;InDate=&#123;1&#125;'</span>.format(nextStr, curStr)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">openChrome</span><span class="params">(curStr, nextStr, hotelId)</span>:</span></span><br><span class="line">    cookesResult = &#123;&#125;</span><br><span class="line">    ua = createUa()</span><br><span class="line">    opts = Options()</span><br><span class="line">    opts.add_argument(<span class="string">"user-agent=&#123;0&#125;"</span>.format(ua))</span><br><span class="line"></span><br><span class="line">    browser = webdriver.Chrome(chrome_options=opts)</span><br><span class="line">    browser.get(<span class="string">'http://hotel.elong.com/'</span>+hotelId)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># time.sleep(3)</span></span><br><span class="line">    cookies = browser.get_cookies()</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> cookies:</span><br><span class="line">        cookesResult[item[<span class="string">'name'</span>]] = item[<span class="string">'value'</span>]</span><br><span class="line">    <span class="keyword">return</span> cookesResult, ua, browser</span><br><span class="line"></span><br><span class="line">postUrl = <span class="string">'http://hotel.elong.com/ajax/detail/gethotelroomsetjva'</span></span><br><span class="line"></span><br><span class="line">postDict = &#123;</span><br><span class="line">  <span class="string">'detailRequest.bookingChannel'</span>: <span class="string">'1'</span>,</span><br><span class="line">  <span class="string">'detailRequest.cardNo'</span>: <span class="string">'192928'</span>,</span><br><span class="line">  <span class="string">'detailRequest.checkInDate'</span>: <span class="string">'2018-06-18'</span>,</span><br><span class="line">  <span class="string">'detailRequest.checkOutDate'</span>: <span class="string">'2018-06-19'</span>,</span><br><span class="line">  <span class="string">'detailRequest.cityId'</span>: <span class="string">'0101'</span>,</span><br><span class="line">  <span class="string">'detailRequest.customerLevel'</span>: <span class="string">'11'</span>,</span><br><span class="line">  <span class="string">'detailRequest.hotelIDs'</span>: <span class="string">'40101215'</span>,</span><br><span class="line">  <span class="string">'detailRequest.isAfterCouponPrice'</span>: <span class="string">'true'</span>,</span><br><span class="line">  <span class="string">'detailRequest.isDebug'</span>: <span class="string">'false'</span>,</span><br><span class="line">  <span class="string">'detailRequest.isLogin'</span>: <span class="string">'false'</span>,</span><br><span class="line">  <span class="string">'detailRequest.isMobileOnly'</span>: <span class="string">'false'</span>,</span><br><span class="line">  <span class="string">'detailRequest.isNeed5Discount'</span>: <span class="string">'false'</span>,</span><br><span class="line">  <span class="string">'detailRequest.isTrace'</span>: <span class="string">'false'</span>,</span><br><span class="line">  <span class="string">'detailRequest.language'</span>: <span class="string">'cn'</span>,</span><br><span class="line">  <span class="string">'detailRequest.needDataFromCache'</span>: <span class="string">'true'</span>,</span><br><span class="line">  <span class="string">'detailRequest.orderFromID'</span>: <span class="string">'50'</span>,</span><br><span class="line">  <span class="string">'detailRequest.payMethod'</span>: <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">'detailRequest.productType'</span>: <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">'detailRequest.promotionChannelCode'</span>: <span class="string">'0000'</span>,</span><br><span class="line">  <span class="string">'detailRequest.proxyID'</span>: <span class="string">'ZD'</span>,</span><br><span class="line">  <span class="string">'detailRequest.sellChannel'</span>: <span class="string">'1'</span>,</span><br><span class="line">  <span class="string">'detailRequest.settlementType'</span>: <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">'detailRequest.updateOrder'</span>: <span class="string">'false'</span></span><br><span class="line">&#125;</span><br><span class="line">reqHeaders = &#123;</span><br><span class="line"><span class="string">'Accept'</span>: <span class="string">'application/json, text/javascript, */*; q=0.01'</span>,</span><br><span class="line"><span class="string">'Accept-Language'</span>: <span class="string">'zh-CN,zh;q=0.9,en;q=0.8,ja;q=0.7,zh-TW;q=0.6'</span>,</span><br><span class="line"><span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded; charset=UTF-8'</span>,</span><br><span class="line"><span class="string">'Host'</span>: <span class="string">'hotel.elong.com'</span>,</span><br><span class="line"><span class="string">'Origin'</span>: <span class="string">'http://hotel.elong.com'</span>,</span><br><span class="line"><span class="string">'Referer'</span>: <span class="string">'http://hotel.elong.com/beijing/'</span>,</span><br><span class="line"><span class="string">'User-Agent'</span>:<span class="string">''</span> ,</span><br><span class="line"><span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> hotelId <span class="keyword">in</span> HOTEL_ID:</span><br><span class="line"></span><br><span class="line">    cur = datetime.datetime.now() + datetime.timedelta(days=<span class="number">-1</span>)</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    cookies, ua, browser = <span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span></span><br><span class="line">    output = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        cur = cur + datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line">        next = cur + datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line">        curStr = cur.strftime(<span class="string">'%Y-%m-%d'</span>)</span><br><span class="line">        nextStr = next.strftime(<span class="string">'%Y-%m-%d'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> count == <span class="number">1</span> <span class="keyword">or</span> count % <span class="number">50</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> count != <span class="number">1</span>:</span><br><span class="line">                browser.close()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                cookies, ua, browser = openChrome(curStr, nextStr, hotelId)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        print(<span class="string">'&#123;0&#125;_&#123;1&#125;_&#123;2&#125;_&#123;3&#125;'</span>,count, hotelId, curStr, nextStr)</span><br><span class="line"></span><br><span class="line">        browser.add_cookie(&#123;</span><br><span class="line">            <span class="string">'name'</span>:<span class="string">'ShHotel'</span>,</span><br><span class="line">            <span class="string">'value'</span>:createDateCookie(curStr, nextStr),</span><br><span class="line">            <span class="comment"># 'value':createDateCookie( '2019-06-16', '2019-06-17'),</span></span><br><span class="line">            <span class="string">'path'</span>:<span class="string">'/'</span>,</span><br><span class="line">            <span class="string">'domain'</span>:<span class="string">'.elong.com'</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        browser.refresh()</span><br><span class="line"></span><br><span class="line">        dom = &#123;&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            dom = browser.find_element_by_class_name(<span class="string">'htype_list'</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        textStr = dom.text.replace(<span class="string">'\n'</span>,<span class="string">' '</span>)</span><br><span class="line">        output.append(&#123;</span><br><span class="line">            <span class="string">'content:'</span>:textStr,</span><br><span class="line">            <span class="comment"># 'contentMd5':md5(textStr),</span></span><br><span class="line">            <span class="string">'inDate'</span>:curStr,</span><br><span class="line">            <span class="string">'outDate'</span>:nextStr,</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        print(md5(dom.text))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> count &gt;= <span class="number">60</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># if count &gt;= 3:</span></span><br><span class="line">        <span class="comment">#     break;</span></span><br><span class="line"></span><br><span class="line">    trans(output, hotelId)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'done'</span>)</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong> 每次我们需要更改 ShHotel 这个 <code>cookie</code> 来改变日历框的日期，以便修改日期抓取价格。另外在抓包的时候，我们发现这个接口会收集我们的设备信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://fireeye1.elong.com/h5/log</span><br><span class="line">http://openapi.elong.com/fp/p</span><br></pre></td></tr></table></figure></p>
<p>采集的抓包如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">req: &#123;&quot;1&quot;:&quot;1&quot;,&quot;4&quot;:&quot;-8&quot;,&quot;5&quot;:&quot;1529332358367&quot;,&quot;6&quot;:&quot;Windows&quot;,&quot;7&quot;:&quot;10&quot;,&quot;8&quot;:&quot;1&quot;,&quot;9&quot;:&quot;WebKit&quot;,&quot;b&quot;:&quot;amd64&quot;,&quot;c&quot;:&quot;Chrome&quot;,&quot;d&quot;:&quot;Chrome&quot;,&quot;i&quot;:&quot;WebKit&quot;,&quot;g&quot;:&quot;67.0.3396.79&quot;,&quot;s&quot;:&quot;6k&quot;,&quot;4w&quot;:&quot;Win32&quot;,&quot;a&quot;:&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.79 Safari/537.36&quot;,&quot;e&quot;:&quot;Google Inc.&quot;,&quot;f&quot;:&quot;Netscape&quot;,&quot;j&quot;:&quot;UTF-8&quot;,&quot;4s&quot;:&quot;0&quot;,&quot;m&quot;:&quot;1&quot;,&quot;o&quot;:&quot;1&quot;,&quot;p&quot;:&quot;1&quot;,&quot;q&quot;:&quot;1&quot;,&quot;4r&quot;:&quot;left=0&amp;top=0&quot;,&quot;t&quot;:&quot;width=1366&amp;height=150&quot;,&quot;u&quot;:&quot;1&quot;,&quot;v&quot;:&quot;1&quot;,&quot;w&quot;:&quot;3&quot;,&quot;x&quot;:&quot;4&quot;,&quot;E&quot;:&quot;0k,2u,3s,4e&quot;,&quot;A&quot;:&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.79 Safari/537.36&quot;,&quot;B&quot;:&quot;Chrome PDF Plugin,I,1f&quot;,&quot;D&quot;:&quot;Google Inc.&quot;,&quot;F&quot;:&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.79 Safari/537.36&quot;,&quot;G&quot;:&quot;4&quot;,&quot;H&quot;:&quot;Netscape&quot;,&quot;I&quot;:&quot;Mozilla&quot;,&quot;J&quot;:&quot;1&quot;,&quot;K&quot;:&quot;2&quot;,&quot;M&quot;:&quot;Win32&quot;,&quot;N&quot;:&quot;Gecko&quot;,&quot;O&quot;:&quot;20030107&quot;,&quot;P&quot;:&quot;&quot;,&quot;R&quot;:&quot;1366&quot;,&quot;S&quot;:&quot;768&quot;,&quot;T&quot;:&quot;1366&quot;,&quot;U&quot;:&quot;728&quot;,&quot;Y&quot;:&quot;1349&quot;,&quot;0a&quot;:&quot;150&quot;,&quot;V&quot;:&quot;24&quot;,&quot;W&quot;:&quot;24&quot;,&quot;X&quot;:&quot;1&quot;,&quot;0b&quot;:&quot;0,2,8,9,a,c,d,g,h,i,k,l,m,o,p,q,s,v,w,x,y,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,Q,R,U,V,0e,0f,0g,0h,0p,0q,0r,0t,0w,0x,1b,1c,1d,1e,1g,1h,1i,1j,1p,1q,1v,1x,1y,2a,2b,2c,2g,2h,2n,2o,2u,2v,2w,2x,2y,3a,3b,3c,3d,3f,3g,3i,3j,3k,3m,3n,3o,3p,3r,3s,3v,3w,3x,3y,4a,4b,4d,4f,4h,4k,4l,4m,4n,4q,4r,4u,4v,4x,4y,5a,5b,5c,5d,5f,5g,5h,5j,5k,5l,5p,5q,5r,5s,5t,5u,5w,5y,6c,6d,6e,6f,6g,6h,6i,6k,6m,6p,6r,6s,6t,6v,6w,6x,6y,7a,7b,7c,7d,7e,7f,7g,7h,7i,7j,7k,7l,7m,7n,7o,7p,7q,7r,7s,7t,7u&quot;,&quot;0c&quot;:&quot;1366x768&quot;,&quot;0e&quot;:&quot;96,96&quot;,&quot;1x&quot;:&quot;0&quot;,&quot;1y&quot;:&quot;0&quot;,&quot;2a&quot;:&quot;0&quot;,&quot;2b&quot;:&quot;0&quot;,&quot;2c&quot;:&quot;0&quot;,&quot;2d&quot;:&quot;1&quot;,&quot;2e&quot;:&quot;1&quot;,&quot;2f&quot;:&quot;1&quot;,&quot;2g&quot;:&quot;0&quot;,&quot;2h&quot;:&quot;0&quot;,&quot;2i&quot;:&quot;1529332351141&quot;,&quot;2j&quot;:&quot;1529332351141&quot;,&quot;2k&quot;:&quot;1529332351142&quot;,&quot;2l&quot;:&quot;0&quot;,&quot;2m&quot;:&quot;0&quot;,&quot;2n&quot;:&quot;1529332350829&quot;,&quot;2o&quot;:&quot;1529332350831&quot;,&quot;2p&quot;:&quot;1529332350831&quot;,&quot;2q&quot;:&quot;1529332350831&quot;,&quot;2r&quot;:&quot;1529332350911&quot;,&quot;2s&quot;:&quot;0&quot;,&quot;2t&quot;:&quot;1529332351136&quot;,&quot;2u&quot;:&quot;1529332351191&quot;,&quot;4l&quot;:&quot;0&quot;,&quot;4m&quot;:&quot;0&quot;,&quot;4n&quot;:&quot;0&quot;,&quot;4o&quot;:&quot;0&quot;,&quot;3d&quot;:&quot;1&quot;,&quot;3e&quot;:&quot;4236268483&quot;,&quot;0g&quot;:&quot;1&quot;,&quot;0h&quot;:&quot;WebKit&quot;,&quot;0i&quot;:&quot;WebKit WebGL&quot;,&quot;0j&quot;:&quot;Google Inc.&quot;,&quot;0k&quot;:&quot;ANGLE (Intel(R) HD Graphics 5500 Direct3D11 vs_5_0 ps_5_0)&quot;,&quot;0l&quot;:&quot;8&quot;,&quot;0m&quot;:&quot;experimental-webgl&quot;,&quot;0n&quot;:&quot;WebGL 1.0 (OpenGL ES 2.0 Chromium)&quot;,&quot;0o&quot;:&quot;WebGL GLSL ES 1.0 (OpenGL ES GLSL ES 1.0 Chromium)&quot;,&quot;0p&quot;:&quot;8&quot;,&quot;0q&quot;:&quot;8&quot;,&quot;0r&quot;:&quot;8&quot;,&quot;0s&quot;:&quot;8&quot;,&quot;0t&quot;:&quot;16384&quot;,&quot;0u&quot;:&quot;16&quot;,&quot;0v&quot;:&quot;16384&quot;,&quot;0w&quot;:&quot;1024&quot;,&quot;0x&quot;:&quot;16&quot;,&quot;0y&quot;:&quot;16384&quot;,&quot;1a&quot;:&quot;30&quot;,&quot;1b&quot;:&quot;16&quot;,&quot;1c&quot;:&quot;4096&quot;,&quot;1d&quot;:&quot;0=1&amp;1=1&quot;,&quot;1e&quot;:&quot;0=1&amp;1=1024&quot;,&quot;1f&quot;:&quot;16384,16384&quot;,&quot;1g&quot;:&quot;16&quot;,&quot;1h&quot;:&quot;high=%5B-1.7014118346046923e%2B38%2C%201.7014118346046923e%2B38%5D%20(23%20bit%20mantissa)&amp;medium=%5B-1.7014118346046923e%2B38%2C%201.7014118346046923e%2B38%5D%20(23%20bit%20mantissa)&amp;low=%5B-1.7014118346046923e%2B38%2C%201.7014118346046923e%2B38%5D%20(23%20bit%20mantissa)&amp;best=%5B-2%5E127%2C%202%5E127%5D%20(23)&quot;,&quot;1i&quot;:&quot;16&quot;,&quot;1j&quot;:&quot;high=%5B-1.7014118346046923e%2B38%2C%201.7014118346046923e%2B38%5D%20(23%20bit%20mantissa)&amp;medium=%5B-1.7014118346046923e%2B38%2C%201.7014118346046923e%2B38%5D%20(23%20bit%20mantissa)&amp;low=%5B-1.7014118346046923e%2B38%2C%201.7014118346046923e%2B38%5D%20(23%20bit%20mantissa)&amp;best=%5B-2%5E127%2C%202%5E127%5D%20(23)&quot;,&quot;1k&quot;:&quot;24&quot;,&quot;1l&quot;:&quot;8&quot;,&quot;1m&quot;:&quot;0&quot;,&quot;1n&quot;:&quot;0,1,2,4,6,7,t,5,d,e,f,g,h,i,j,k,n,w,WEBGL_compressed_texture_s3tc_srgb,o,p,q,x,r,s,y&quot;,&quot;1o&quot;:&quot;4&quot;,&quot;1q&quot;:&quot;1&quot;,&quot;1p&quot;:&quot;140566696&quot;,&quot;a14&quot;:&quot;51c833e55debe65f41028c2e9d3a9216&quot;,&quot;a15&quot;:&quot;962f0b00b16ff49e882f08e7f4762d6f&quot;,&quot;a16&quot;:&quot;334dc779e7b38de9533baa2c2ca94657&quot;,&quot;token&quot;:&quot;931637e1-dd9c-45d6-934d-4b2571d611d3&quot;,&quot;a20&quot;:&quot;axrh7lrh7&quot;&#125;</span><br></pre></td></tr></table></figure></p>
<p>为了防止指纹对我们的<code>seleium</code>抓包产生影响，嘿嘿，直接把这几个域名干掉就ok拉，修改hosts文件，让指纹无法收集：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 fireeye1.elong.com</span><br><span class="line">127.0.0.1 openapi.elong.com</span><br><span class="line">127.0.0.1 tj.elongstatic.com</span><br></pre></td></tr></table></figure></p>
<p>可能指纹收集人畜无害，但是还是干掉比较稳妥，嘿嘿。这样使用<code>seleium</code>方式粗暴的抓取，有如下特点：</p>
<p>第一，这样抓取效率比较低，每抓取一个日期的价格，就需要对chrome刷新一次，大概几秒钟能抓一个价格。</p>
<p>第二，这样抓取任务虽然完成了，但是只能算绕道完成，并没有真正的完成一次反爬系统的破解，下面我就记录了详细破解x龙放爬系统的过程。</p>
<h2 id="正面对抗，逆向x龙的防爬系统"><a href="#正面对抗，逆向x龙的防爬系统" class="headerlink" title="正面对抗，逆向x龙的防爬系统"></a>正面对抗，逆向x龙的防爬系统</h2><p>首先我们打开任意一个酒店详情页的地址，如下：</p>
<p><code>http://hotel.elong.com/91777359/</code></p>
<p>通过<code>Chrome</code>的抓包<code>network</code>，我们看到酒店的价格是通过<code>ajax</code>的方式获取的，<code>ajax</code>的url地址如下：</p>
<p><code>POST http://hotel.elong.com/ajax/detail/gethotelroomsetjva</code></p>
<p><code>POST</code>的<code>body</code>中存放了各种不同的请求参数，每个参数都是<code>detailRequest.xxx</code>开头的，只有一个除外，那就是<code>code</code>参数，一个<code>POST</code>的请求示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">code: 7290930</span><br><span class="line">detailRequest.bookingChannel: 1</span><br><span class="line">detailRequest.cardNo: 192928</span><br><span class="line">detailRequest.checkInDate: 2018-06-19</span><br><span class="line">detailRequest.checkOutDate: 2018-06-20</span><br><span class="line">detailRequest.cityId: 0101</span><br><span class="line">detailRequest.customerLevel: 11</span><br><span class="line">detailRequest.hotelIDs: 91777359</span><br><span class="line">detailRequest.isAfterCouponPrice: true</span><br><span class="line">detailRequest.isDebug: false</span><br><span class="line">detailRequest.isLogin: false</span><br><span class="line">detailRequest.isMobileOnly: false</span><br><span class="line">detailRequest.isNeed5Discount: false</span><br><span class="line">detailRequest.isTrace: false</span><br><span class="line">detailRequest.language: cn</span><br><span class="line">detailRequest.needDataFromCache: true</span><br><span class="line">detailRequest.orderFromID: 50</span><br><span class="line">detailRequest.payMethod: 0</span><br><span class="line">detailRequest.productType: 0</span><br><span class="line">detailRequest.promotionChannelCode: 0000</span><br><span class="line">detailRequest.proxyID: ZD</span><br><span class="line">detailRequest.sellChannel: 1</span><br><span class="line">detailRequest.settlementType: 0</span><br><span class="line">detailRequest.updateOrder: false</span><br><span class="line">detailRequest.ctripToken: d2f2747f-f8dc-45b0-a54f-a805e509ecc6</span><br><span class="line">detailRequest.elongToken: 931637e1-dd9c-45d6-934d-4b2571d611d3</span><br></pre></td></tr></table></figure>
<p>本着随便看看的想法，把上述请求拷贝成<code>curl</code>命令，同时修改请求参数的<code>detailRequest.checkInDate</code>和<code>detailRequest.checkOutDate</code>，改成其他的日期，发起另一个请求，看看对方是否完全不设防。</p>
<p>不过很遗憾，当我们手动修改入住和离开日期后，得到的房价和房态信息都还是老的信息，看来里面确实有猫腻。看来x龙的<code>PC</code>站不是完全不设防么，不过想想也对，如果完全不设防，也不需要我们来攻破了。</p>
<p>在抓取页面的时候，我们发现在页面点击<code>修改日期</code>按钮，会重新发起一次<code>ajax</code>请求，会刷新价格列表组件。这样我们就简单不少了，可以很方便的调试<code>js</code>代码，同时也方便的重试和重放了。</p>
<p>我们剥开其他请求和影响，来一次独立的获取价格列表的流程吧。我们打开chrome的application页签，把cookie都清除了，但是很快，有3个cookie又会马上生成了，同时没有<code>xhr</code>的请求，也就是说这3个cookie肯定是<code>js</code>生成的，并不是服务器端生成，生成的cookie如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_RDG=28bdb2c1aa0c192f95353348b2fcee22e1; 2098-01-31T16:00:00.000Z</span><br><span class="line">_RGUID=d2f2747f-f8dc-45b0-a54f-a805e509ecc6; 2098-01-31T16:00:00.000Z</span><br><span class="line">_RSG=mM4tu_7ToBD6pU2bN0gFLA; 2098-01-31T16:00:00.000Z</span><br></pre></td></tr></table></figure>
<p>从程序员的直觉，觉得这3个cookie应该和防爬系统没关系，主要是用来追踪用户下单，理由如下：</p>
<p>1、如果是防爬系统的校验码，纯粹由<code>js</code>生成，很容易被恶意用户利用，所以一般校验码都是服务端生成</p>
<p>2、从cookie名称命名看，都是统计使用的</p>
<p>3、一般防爬的cookie都是<code>session</code>方式的，不会使用过期时间80年这种</p>
<p>当然，从后面的破解流程看，这3个cookie确实可以忽略的，仅仅是广告，追踪使用的。</p>
<p>回到之前的话题，我们清除cookie之后，手动点击了<code>修改日期</code>按钮，我们通过网络的抓包工具，看到了2个请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET    http://hotel.elong.com/ajax/detail/getcode.html?xxxxx // 忽略请求参数</span><br><span class="line">POST   http://hotel.elong.com/ajax/detail/gethotelroomsetjva</span><br></pre></td></tr></table></figure>
<p>同时，我们的cookie里面也多了如下几个：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CookieGuid  </span><br><span class="line">Esid</span><br><span class="line">JSESSIONID</span><br><span class="line">SessionGuid</span><br><span class="line">ShHotel</span><br><span class="line">newjava1</span><br><span class="line">s_visit</span><br></pre></td></tr></table></figure></p>
<p>我们再看 <code>http://hotel.elong.com/ajax/detail/getcode.html?xxxxx</code> 这个请求返回的头部，有如下 <code>set-cookie</code> 字段：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: CookieGuid=73565388-6064-436d-a9e5-dbe29eb7db13; Domain=elong.com; Expires=Wed, 17-Jun-2020 14:44:00 GMT; Path=/</span><br><span class="line">Set-Cookie: SessionGuid=a6bf0d13-d2b5-4dfd-96f9-2a7c6c53bf6b; Domain=elong.com; Path=/; HttpOnly</span><br><span class="line">Set-Cookie: Esid=4897f495-f43c-4a46-bd93-accf9e01788e; Domain=elong.com; Path=/; HttpOnly</span><br><span class="line">Set-Cookie: newjava1=efe6f0f8ebc30d67fa39cbcb8d5043e7; Path=/</span><br><span class="line">Set-Cookie: JSESSIONID=ACB2F6925C6A381BF5F94158BC5B3C1B; Path=/; HttpOnly</span><br></pre></td></tr></table></figure></p>
<p>仔细对比了<code>set-cookie</code>和<code>chrome</code>浏览器里的内容，我们发现前端的<code>js</code>并没有修改<code>cookie</code>的内容，然后详细看了<code>getcode.html</code>接口的返回，发现里面有一个<code>value</code>字段有点意思，感觉像是<code>base64</code>编码过的，于是对他进行<code>base64</code>反解析，出现了乱码，感觉应该是一个加密串。</p>
<p>下面就是<code>chrome</code>的调试大法了，我们通过<code>network</code>的<code>initiator</code>一栏，在<code>js</code>触发器那栏点击进去，然后打上断点，同时通过<code>chrome</code>的调试面板右侧的<code>Call Stack</code>调用堆栈，很容易就追踪了当<code>getcode.html</code>请求发起后，<code>gethotelroomsetjva</code>发起前，究竟发生了什么。</p>
<p>说实话，我发现在请求<code>gethotelroomsetjva</code>这个接口的时候，日期什么等其他参数不变，<code>code</code>参数在清除cookie后，却每次都变更，所以参数<code>code</code>似乎是一个突破口，如何逆向破解得到<code>code</code>的生成方法，就是本次破解x龙防爬系统的关键。</p>
<p>通过断点调试+调用堆栈，我们发现 <code>code</code> 参数的生成是通过一个<code>window.getCheckCodeByType</code>函数的，通过<code>step-in</code>步入调试，我们拿到了生成<code>code</code>的代码，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">abcdefg</span>(<span class="params">dynamicScript, type</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> == dynamicScript || dynamicScript == <span class="string">''</span> || dynamicScript == <span class="string">'$&#123;tsd&#125;'</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-99</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> script = hijklmn(dynamicScript, type);</span><br><span class="line">            <span class="keyword">var</span> code = <span class="built_in">eval</span>(script);</span><br><span class="line">            <span class="keyword">return</span> code</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-99</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">hijklmn</span>(<span class="params">script, type</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == script || script == <span class="string">''</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> script</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> decScript = lmnopq(script, qwertyui(type));</span><br><span class="line">        <span class="keyword">var</span> result = decScript.replace(<span class="regexp">/\)\^-1/gm</span>, <span class="string">")&amp;-1"</span>);</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">lmnopq</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> keyHex = CryptoJS.enc.Utf8.parse(b);</span><br><span class="line">        <span class="keyword">var</span> decrypted = CryptoJS.DES.decrypt(&#123;</span><br><span class="line">            ciphertext: CryptoJS.enc.Base64.parse(a)</span><br><span class="line">        &#125;, keyHex, &#123;</span><br><span class="line">            mode: CryptoJS.mode.ECB,</span><br><span class="line">            padding: CryptoJS.pad.Pkcs7</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">var</span> c = decrypted.toString(CryptoJS.enc.Utf8);</span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">qwertyui</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">'list'</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> key = getFormatDateString(pageController.requestInfo.checkInDate) + pageController.requestInfo.cityID + getFormatDateString(pageController.requestInfo.checkOutDate)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'detail'</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> key = getFormatDateString(pageController.detailRequest.checkInDate) + pageController.detailRequest.hotelIDs + getFormatDateString(pageController.detailRequest.checkOutDate)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> key = pageController.detailRequest.hotelIDs</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> abcdef(key)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">qwertyuir</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">'list'</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> key = getFormatDateString(pageController.requestInfo.checkInDate) + pageController.requestInfo.firstHotelInfo + getFormatDateString(pageController.requestInfo.checkOutDate)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'detail'</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> key = getFormatDateString(pageController.detailRequest.checkInDate) + pageController.detailRequest.customerLevel + getFormatDateString(pageController.detailRequest.checkOutDate)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'comment'</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> key = pageController.detailRequest.hotelIDs + pageController.detailRequest.customerLevel</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> abcdef(key)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getFormatDateString</span>(<span class="params">dateString</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> E.date.getDateString(E.date.stringToDate(dateString))</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="keyword">return</span> dateString</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">abcdef</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> hashCode = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> value != <span class="literal">undefined</span> &amp;&amp; value != <span class="literal">null</span> &amp;&amp; value != <span class="string">""</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> code = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; value.length; i++) &#123;</span><br><span class="line">                code = value.charCodeAt(i);</span><br><span class="line">                hashCode = ((hashCode &lt;&lt; <span class="number">5</span>) - hashCode) + code;</span><br><span class="line">                hashCode = hashCode &amp; hashCode</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> hashString = hashCode.toString();</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">8</span>).join(<span class="string">'e'</span>) + hashString).slice(<span class="number">-8</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">abcdefh</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> hashCode = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> value != <span class="literal">undefined</span> &amp;&amp; value != <span class="literal">null</span> &amp;&amp; value != <span class="string">""</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> code = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; value.length; i++) &#123;</span><br><span class="line">                code = value.charCodeAt(i);</span><br><span class="line">                hashCode = ((hashCode &lt;&lt; <span class="number">5</span>) - hashCode) + code;</span><br><span class="line">                hashCode = hashCode &amp; hashCode</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> hashString = hashCode.toString();</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">8</span>).join(<span class="string">'r'</span>) + hashString).slice(<span class="number">-8</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    root.getCheckCodeByType = abcdefg;</span><br><span class="line">&#125;</span><br><span class="line">)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure>
<p>通过多次调试，发现此段代码是固定的，虽然<code>code</code>每次请求会变更，但是这段生成<code>code</code>的代码是不会变的，通过调试我们发现，<code>abcdefg(dynamicScript, type)</code> 这个函数，<code>type</code>是固定的值为: <code>detail</code>，我猜应该是表示获取酒店的详情的意思。而<code>dynamicScript</code>这个参数就是通过<code>getcode.html</code>这个接口返回的。</p>
<p>期间还踩了一个<code>chrome</code>的小坑，我从<code>network</code>页签的<code>Preview</code>拷贝的加密串，一直报如下错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Error: Malformed UTF-8 data</span><br><span class="line">    at Object.stringify (D:\nodejs\node_modules\crypto-js\core.js:478:24)</span><br><span class="line">    at WordArray.init.toString (D:\nodejs\node_modules\crypto-js\core.js:215:38)</span><br><span class="line">    at lmnopq (D:\nodejs\cheat_elong.js:77:23)</span><br><span class="line">    at hijklmn (D:\nodejs\cheat_elong.js:65:21)</span><br><span class="line">    at abcdefg (D:\nodejs\cheat_elong.js:53:22)</span><br><span class="line">    at Object.&lt;anonymous&gt; (D:\nodejs\cheat_elong.js:148:9)</span><br><span class="line">    at Module._compile (internal/modules/cjs/loader.js:702:30)</span><br><span class="line">    at Object.Module._extensions..js (internal/modules/cjs/loader.js:713:10)</span><br><span class="line">    at Module.load (internal/modules/cjs/loader.js:612:32)</span><br><span class="line">    at tryModuleLoad (internal/modules/cjs/loader.js:551:12)</span><br></pre></td></tr></table></figure>
<p>后来通过对比发现，在<code>Preview</code>里面拷贝加密串，会有<code>...</code>的东西，得从<code>response</code>里面拷贝，就没有问题了。</p>
<p>经过这个小插曲后，我利用 <code>node.js</code> 简单补全了上述<code>sdk</code>里的函数，让他可以跑起来，同时安装了<code>crypot-js</code>包，用来解密字符串。通过对<code>node.js</code>的调试，我们发现，这个<code>sdk</code>其实就是把加密串，解密，然后通过<code>eval</code>函数跑起来，算出一个<code>code</code>的数字，在下一个获取详情的接口里带上来，进行校验。相信<code>code</code>的结果应该已经在上述的这些 cookie 里了，如果猜的没错的话，可能存放在 <code>newjava1</code> 这个cookie里的。不过这个我们关心，我们只需要把所有cookie带上，同时通过我们自己的 <code>node.js</code> 脚本算出的 <code>code</code> 应该和浏览器里相同。</p>
<p>本来想着到这步应该没问题了吧，字符串也解密出来了，但是算出的<code>code</code>值一直和在x龙网站上算出的不同，我开始怀疑那段<code>eval</code>的脚本里面可能有投毒，下面是一个<code>eval</code>的例子，<code>eval</code>的代码里充斥着各种的注释和混淆，我们简单过滤后的一个执行脚本如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> __sOVO= <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;         <span class="comment">// 经过简单的封装，我们看下入参node.js里和x龙网站是否相同</span></span><br><span class="line">	<span class="keyword">var</span> arguments2 = [].slice.call(<span class="built_in">arguments</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">console</span>.log(arguments2)</span><br><span class="line">	<span class="keyword">let</span> x = <span class="built_in">String</span>.fromCharCode</span><br><span class="line">	<span class="keyword">let</span> y = x.apply(<span class="built_in">String</span>, arguments2)</span><br><span class="line">	<span class="built_in">console</span>.log(y)</span><br><span class="line">	<span class="keyword">return</span> y</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// var __sOVO = String.fromCharCode</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _x_p7P = [<span class="number">3846</span>,<span class="number">3041</span>,<span class="number">464</span>,<span class="number">3620</span>,<span class="number">366</span>,];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _$uX0=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">arguments</span>[<span class="number">0</span>]^</span><br><span class="line">_x_p7P[<span class="number">0</span>];&#125;;</span><br><span class="line"><span class="keyword">var</span> _$rQE=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">arguments</span>[<span class="number">0</span>]^</span><br><span class="line">_x_p7P[<span class="number">1</span>];&#125;;</span><br><span class="line"><span class="keyword">var</span> _$<span class="number">4</span>qj=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">arguments</span>[<span class="number">0</span>]^</span><br><span class="line">_x_p7P[<span class="number">2</span>];&#125;;</span><br><span class="line"><span class="keyword">var</span> _$ldXO=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">arguments</span>[<span class="number">0</span>]^</span><br><span class="line">_x_p7P[<span class="number">3</span>];&#125;;</span><br><span class="line"><span class="keyword">var</span> _$fgfk=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">arguments</span>[<span class="number">0</span>]^</span><br><span class="line">_x_p7P[<span class="number">4</span>];&#125;;</span><br><span class="line"><span class="built_in">eval</span>(__sOVO(<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">__sOVO(<span class="number">101</span>,~(<span class="number">0x76</span>^<span class="number">-1</span>),~~<span class="number">97</span>,<span class="number">108</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">40</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">40</span>,<span class="number">102</span>,<span class="number">117</span>,<span class="number">110</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),~(<span class="number">0x63</span>^<span class="number">-1</span>),</span><br><span class="line"><span class="number">116</span>,<span class="number">105</span>,<span class="number">0157</span>,<span class="number">0x6e</span>,<span class="number">40</span>,<span class="number">0x7841</span>/<span class="number">0400</span>,~~<span class="number">41</span>,<span class="number">123</span>,<span class="number">118</span>,<span class="number">978</span>/<span class="number">0xA</span>,</span><br><span class="line"><span class="number">114</span>,<span class="number">32</span>,~~<span class="number">100</span>,<span class="number">075</span>,<span class="number">34</span>,<span class="built_in">Math</span>.abs(<span class="number">34</span>)&amp;<span class="number">-1</span>,~~<span class="number">59</span>,<span class="number">118</span>,<span class="number">0x6196</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">114</span>,</span><br><span class="line"><span class="number">32</span>,<span class="number">112</span>,<span class="number">61</span>,<span class="number">48</span>,<span class="number">59</span>,<span class="number">119</span>,<span class="number">0150</span>,_$rQE(<span class="number">2952</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>)),<span class="number">0x6c</span>,_$ldXO(~~<span class="number">3649</span>),</span><br><span class="line"><span class="number">0x2863</span>/<span class="number">0400</span>,<span class="number">112</span>,_$rQE(<span class="number">05735</span>),<span class="number">1208</span>/<span class="number">0xA</span>,<span class="number">46</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),~(<span class="number">0x6c</span>^<span class="number">-1</span>),~~<span class="number">101</span>,<span class="number">110</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),~(<span class="number">0x67</span>^<span class="number">-1</span>),<span class="number">1167</span>/<span class="number">0xA</span>,</span><br><span class="line"><span class="number">1049</span>/<span class="number">0xA</span>,<span class="built_in">Math</span>.abs(<span class="number">41</span>)&amp;<span class="number">-1</span>,<span class="number">0x7b42</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">105</span>,<span class="number">102</span>,<span class="number">40</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">120</span>,<span class="number">46</span>,_$uX0(<span class="number">3941</span>),_$ldXO(<span class="number">3660</span>),</span><br><span class="line"><span class="number">971</span>/<span class="number">0xA</span>,<span class="number">114</span>,<span class="number">658</span>/<span class="number">0xA</span>,_$uX0(<span class="number">0x0</span>|<span class="number">0xf72</span>),<span class="built_in">Math</span>.abs(<span class="number">40</span>)&amp;<span class="number">-1</span>,<span class="number">0x7047</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">-1</span>-~(<span class="number">0x29</span>^<span class="number">0</span>),<span class="number">0x21</span>,<span class="number">61</span>,_$ldXO(<span class="number">-1</span>-~(<span class="number">0xe06</span>^<span class="number">0</span>)),</span><br><span class="line"><span class="number">96</span>,_$fgfk(~~<span class="number">332</span>),<span class="number">0x29</span>,<span class="number">0144</span>,<span class="number">432</span>/<span class="number">0xA</span>,_$<span class="number">4</span>qj(<span class="number">0755</span>),<span class="number">120</span>,<span class="number">0x2e22</span>/<span class="number">0400</span>,<span class="number">0143</span>,_$ldXO(<span class="number">3660</span>),</span><br><span class="line"><span class="built_in">Math</span>.abs(<span class="number">97</span>)&amp;<span class="number">-1</span>,<span class="built_in">Math</span>.abs(<span class="number">114</span>)&amp;<span class="number">-1</span>,<span class="number">65</span>,_$uX0(<span class="number">0xf7227</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>),<span class="number">40</span>,<span class="number">1125</span>/<span class="number">0xA</span>,<span class="number">43</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),_$rQE(<span class="built_in">Math</span>.abs(<span class="number">3018</span>)&amp;<span class="number">-1</span>),~(<span class="number">0x29</span>^<span class="number">-1</span>),<span class="number">59</span>,</span><br><span class="line"><span class="number">0145</span>,<span class="number">1087</span>/<span class="number">0xA</span>,<span class="number">0x73</span>,<span class="number">101</span>,<span class="number">0173</span>,~~<span class="number">118</span>,<span class="number">97</span>,<span class="number">114</span>,<span class="number">32</span>,<span class="number">0x6c04</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+__sOVO(<span class="built_in">Math</span>.abs(<span class="number">61</span>)&amp;<span class="number">-1</span>,<span class="number">120</span>,_$rQE(<span class="number">3023</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>)),<span class="number">990</span>/<span class="number">0xA</span>,<span class="number">0x6860</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,_$<span class="number">4</span>qj(<span class="number">433</span>),<span class="number">114</span>,<span class="number">67</span>,<span class="number">111</span>,<span class="number">100</span>,</span><br><span class="line"><span class="number">101</span>,<span class="number">65</span>,<span class="number">-1</span>-~(<span class="number">0x74</span>^<span class="number">0</span>),~(<span class="number">0x28</span>^<span class="number">-1</span>),<span class="number">0x7075</span>/<span class="number">0400</span>,<span class="number">-1</span>-~(<span class="number">0x2b</span>^<span class="number">0</span>),<span class="number">511</span>/<span class="number">0xA</span>,<span class="number">41</span>,<span class="built_in">Math</span>.abs(<span class="number">45</span>)&amp;<span class="number">-1</span>,_$ldXO(<span class="number">-1</span>-~(<span class="number">0xe16</span>^<span class="number">0</span>)),</span><br><span class="line"><span class="built_in">Math</span>.abs(<span class="number">56</span>)&amp;<span class="number">-1</span>,<span class="number">0x3b77</span>/<span class="number">0400</span>,~(<span class="number">0x69</span>^<span class="number">-1</span>),<span class="number">0x6616</span>/<span class="number">0400</span>,<span class="number">0x0</span>|<span class="number">0x28</span>,<span class="number">108</span>,~(<span class="number">0x3e</span>^<span class="number">-1</span>),<span class="number">52</span>,_$uX0(<span class="number">3887</span>),<span class="number">100</span>,</span><br><span class="line"><span class="number">-1</span>-~(<span class="number">0x2b</span>^<span class="number">0</span>),<span class="number">61</span>,<span class="built_in">Math</span>.abs(<span class="number">100</span>)&amp;<span class="number">-1</span>,_$uX0(<span class="number">3880</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>)),_$ldXO(<span class="number">3671</span>),<span class="number">117</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),_$fgfk(<span class="number">0414</span>),<span class="number">-1</span>-~(<span class="number">0x73</span>^<span class="number">0</span>),<span class="number">116</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">114</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),</span><br><span class="line"><span class="built_in">Math</span>.abs(<span class="number">40</span>)&amp;<span class="number">-1</span>,<span class="number">0x6490</span>/<span class="number">0400</span>,<span class="number">46</span>,<span class="number">108</span>,<span class="number">0145</span>,~(<span class="number">0x6e</span>^<span class="number">-1</span>),_$fgfk(<span class="number">265</span>),<span class="number">116</span>,<span class="number">104</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),_$ldXO(<span class="number">35933</span>/<span class="number">0xA</span>),</span><br><span class="line"><span class="number">120</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">46</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">-1</span>-~(<span class="number">0x63</span>^<span class="number">0</span>),<span class="number">104</span>,<span class="number">0x61</span>,_$<span class="number">4</span>qj(<span class="number">418</span>),~(<span class="number">0x43</span>^<span class="number">-1</span>),~~<span class="number">111</span>,<span class="number">100</span>,<span class="number">1010</span>/<span class="number">0xA</span>,</span><br><span class="line"><span class="number">0101</span>,<span class="number">0x74</span>,<span class="number">40</span>,<span class="number">112</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">0x2b78</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="built_in">Math</span>.abs(<span class="number">49</span>)&amp;<span class="number">-1</span>,~(<span class="number">0x29</span>^<span class="number">-1</span>),<span class="number">0x2a52</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">0x3946</span>/<span class="number">0400</span>,<span class="number">54</span>,</span><br><span class="line"><span class="number">45</span>,<span class="number">120</span>,<span class="number">46</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),~(<span class="number">0x63</span>^<span class="number">-1</span>),<span class="number">104</span>,<span class="number">0x6110</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">114</span>,<span class="number">67</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">111</span>,<span class="number">100</span>,</span><br><span class="line"><span class="number">101</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">65</span>,<span class="built_in">Math</span>.abs(<span class="number">116</span>)&amp;<span class="number">-1</span>,<span class="number">050</span>,<span class="number">112</span>,<span class="number">43</span>,<span class="number">50</span>,<span class="number">0x2995</span>/<span class="number">0400</span>,<span class="number">0x2b93</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,_$ldXO(~~<span class="number">3607</span>),</span><br><span class="line">_$<span class="number">4</span>qj(<span class="number">481</span>),_$fgfk(<span class="number">350</span>),<span class="number">0x3495</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">45</span>,<span class="number">0x6c29</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">44</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">0154</span>,_$rQE(<span class="number">0x0</span>|<span class="number">0xbc8</span>),<span class="built_in">Math</span>.abs(<span class="number">59</span>)&amp;<span class="number">-1</span>,<span class="number">101</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+__sOVO(_$<span class="number">4</span>qj(<span class="number">444</span>),_$fgfk(<span class="number">285</span>),<span class="number">0x6540</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">040</span>,_$ldXO(<span class="number">3648</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>)),~(<span class="number">0x2b</span>^<span class="number">-1</span>),<span class="number">61</span>,<span class="number">0x22</span>,<span class="number">0x6091</span>/<span class="number">0400</span>,<span class="number">34</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),</span><br><span class="line"><span class="number">59</span>,_$fgfk(<span class="number">286</span>),<span class="number">43</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">61</span>,<span class="number">523</span>/<span class="number">0xA</span>,<span class="number">0x0</span>|<span class="number">0x7d</span>,<span class="number">0x7d97</span>/<span class="number">0400</span>,~(<span class="number">0x72</span>^<span class="number">-1</span>),<span class="number">1017</span>/<span class="number">0xA</span>,<span class="number">116</span>,</span><br><span class="line"><span class="number">-1</span>-~(<span class="number">0x75</span>^<span class="number">0</span>),<span class="number">114</span>,<span class="number">110</span>,~~<span class="number">32</span>,<span class="number">100</span>,<span class="number">125</span>,<span class="number">0x2974</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,_$rQE(<span class="number">30171</span>/<span class="number">0xA</span>),_$uX0(<span class="number">3876</span>),<span class="number">0x6527</span>/<span class="number">0400</span>,</span><br><span class="line"><span class="number">0x7845</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">101</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),~(<span class="number">0x63</span>^<span class="number">-1</span>),<span class="number">117</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),_$ldXO(<span class="number">3664</span>),<span class="number">101</span>,_$fgfk(<span class="number">326</span>),<span class="number">0x29</span>,<span class="number">073</span>,_$ldXO(<span class="number">3650</span>),</span><br><span class="line"><span class="number">0x0</span>|<span class="number">0x75</span>,_$fgfk(<span class="number">0x10003</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>),<span class="number">99</span>,<span class="number">116</span>,<span class="number">-1</span>-~(<span class="number">0x69</span>^<span class="number">0</span>),<span class="built_in">Math</span>.abs(<span class="number">111</span>)&amp;<span class="number">-1</span>,<span class="number">0x0</span>|<span class="number">0x6e</span>,<span class="number">0x2084</span>/<span class="number">0400</span>,<span class="number">96</span>,<span class="number">32</span>,</span><br><span class="line">_$<span class="number">4</span>qj(<span class="number">506</span>),<span class="built_in">Math</span>.abs(<span class="number">37</span>)&amp;<span class="number">-1</span>,~~<span class="number">32</span>,<span class="number">0x7b</span>,_$ldXO(~(<span class="number">0xe50</span>^<span class="number">-1</span>)),~~<span class="number">114</span>,<span class="number">0x79</span>,<span class="number">0x2087</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">123</span>,<span class="number">0x72</span>,</span><br><span class="line">~(<span class="number">0x65</span>^<span class="number">-1</span>),<span class="number">0x7427</span>/<span class="number">0400</span>,<span class="number">0x75</span>,~(<span class="number">0x72</span>^<span class="number">-1</span>),<span class="number">-1</span>-~(<span class="number">0x6e</span>^<span class="number">0</span>),<span class="number">32</span>,~(<span class="number">0x64</span>^<span class="number">-1</span>),<span class="number">40</span>,~(<span class="number">0x37</span>^<span class="number">-1</span>),<span class="number">0x3843</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,</span><br><span class="line"><span class="number">0x35</span>,<span class="number">54</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">49</span>,<span class="number">55</span>,~~<span class="number">52</span>,<span class="number">44</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">0x2076</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">0x0</span>|<span class="number">0x36</span>,<span class="number">49</span>,_$ldXO(<span class="number">0xe1d</span>),</span><br><span class="line">_$<span class="number">4</span>qj(<span class="number">508</span>),<span class="number">32</span>,<span class="number">0x0</span>|<span class="number">0x37</span>,<span class="number">49</span>,<span class="number">-1</span>-~(<span class="number">0x36</span>^<span class="number">0</span>),<span class="number">44</span>,<span class="number">32</span>,<span class="number">530</span>/<span class="number">0xA</span>,<span class="number">0x0</span>|<span class="number">0x33</span>,~(<span class="number">0x39</span>^<span class="number">-1</span>),</span><br><span class="line"><span class="number">054</span>,<span class="built_in">Math</span>.abs(<span class="number">32</span>)&amp;<span class="number">-1</span>,~~<span class="number">56</span>,<span class="number">55</span>,<span class="number">50</span>,<span class="number">054</span>,<span class="number">040</span>,<span class="number">062</span>,<span class="number">-1</span>-~(<span class="number">0x39</span>^<span class="number">0</span>),<span class="number">498</span>/<span class="number">0xA</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+__sOVO(_$<span class="number">4</span>qj(<span class="number">0x1fc</span>),_$fgfk(<span class="number">3345</span>/<span class="number">0xA</span>),<span class="number">56</span>,<span class="number">57</span>,<span class="number">52</span>,<span class="number">0x2c33</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">326</span>/<span class="number">0xA</span>,~(<span class="number">0x37</span>^<span class="number">-1</span>),<span class="number">54</span>,<span class="number">0x33</span>,</span><br><span class="line"><span class="number">0x2c41</span>/<span class="number">0400</span>,<span class="number">32</span>,<span class="number">49</span>,<span class="number">070</span>,<span class="number">0x60</span>,<span class="number">040</span>,~(<span class="number">0x2a</span>^<span class="number">-1</span>),<span class="number">0x0</span>|<span class="number">0x21</span>,<span class="number">-1</span>-~(<span class="number">0x32</span>^<span class="number">0</span>),<span class="number">44</span>,</span><br><span class="line"><span class="built_in">Math</span>.abs(<span class="number">32</span>)&amp;<span class="number">-1</span>,<span class="number">071</span>,<span class="number">0x31</span>,<span class="number">0x0</span>|<span class="number">0x31</span>,<span class="number">44</span>,_$<span class="number">4</span>qj(<span class="number">496</span>),_$fgfk(<span class="number">348</span>),<span class="number">96</span>,<span class="number">-1</span>-~(<span class="number">0x20</span>^<span class="number">0</span>),<span class="number">0x0</span>|<span class="number">0x39</span>,</span><br><span class="line"><span class="number">041</span>,_$fgfk(<span class="number">351</span>),_$rQE(<span class="number">30271</span>/<span class="number">0xA</span>),<span class="number">44</span>,<span class="number">323</span>/<span class="number">0xA</span>,<span class="number">496</span>/<span class="number">0xA</span>,<span class="number">0x0</span>|<span class="number">0x35</span>,<span class="number">0x34</span>,<span class="number">44</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">32</span>,</span><br><span class="line"><span class="number">55</span>,_$fgfk(<span class="number">0x15b55</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>),<span class="number">0x32</span>,<span class="built_in">Math</span>.abs(<span class="number">44</span>)&amp;<span class="number">-1</span>,<span class="number">32</span>,<span class="number">0x0</span>|<span class="number">0x35</span>,<span class="number">0x0</span>|<span class="number">0x32</span>,<span class="number">96</span>,<span class="number">0x0</span>|<span class="number">0x20</span>,<span class="number">0x3e06</span>/<span class="number">0400</span>,</span><br><span class="line"><span class="number">330</span>/<span class="number">0xA</span>,<span class="number">52</span>,<span class="number">443</span>/<span class="number">0xA</span>,<span class="number">040</span>,<span class="number">0x36</span>,<span class="number">49</span>,<span class="number">55</span>,<span class="number">440</span>/<span class="number">0xA</span>,<span class="number">040</span>,<span class="number">063</span>,</span><br><span class="line"><span class="number">066</span>,<span class="number">57</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">0x0</span>|<span class="number">0x2c</span>,<span class="number">0x2014</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="built_in">Math</span>.abs(<span class="number">49</span>)&amp;<span class="number">-1</span>,<span class="number">0x0</span>|<span class="number">0x38</span>,<span class="number">0x0</span>|<span class="number">0x37</span>,<span class="number">-1</span>-~(<span class="number">0x2c</span>^<span class="number">0</span>),<span class="number">32</span>,~(<span class="number">0x35</span>^<span class="number">-1</span>),</span><br><span class="line">~~<span class="number">50</span>,<span class="number">52</span>,<span class="number">0x0</span>|<span class="number">0x29</span>,<span class="number">59</span>,<span class="number">125</span>,~~<span class="number">32</span>,<span class="number">99</span>,<span class="number">97</span>,<span class="number">0x0</span>|<span class="number">0x74</span>,<span class="number">99</span>,</span><br><span class="line"><span class="number">104</span>,<span class="number">32</span>,~~<span class="number">40</span>,<span class="number">0x65</span>,<span class="number">0x2954</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">0x0</span>|<span class="number">0x60</span>,~~<span class="number">33</span>,_$rQE(<span class="number">0xbdb20</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>),_$uX0(<span class="number">3875</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>)),<span class="number">0x2d28</span>/<span class="number">0400</span>,</span><br><span class="line">_$<span class="number">4</span>qj(<span class="number">-1</span>-~(<span class="number">0x1e9</span>^<span class="number">0</span>)),<span class="number">57</span>,<span class="number">-1</span>-~(<span class="number">0x3b</span>^<span class="number">0</span>),<span class="built_in">Math</span>.abs(<span class="number">125</span>)&amp;<span class="number">-1</span>,<span class="number">125</span>,<span class="number">96</span>,<span class="number">-1</span>-~(<span class="number">0x21</span>^<span class="number">0</span>),<span class="number">0140</span>,<span class="number">37</span>,<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+__sOVO(<span class="number">40</span>,<span class="number">419</span>/<span class="number">0xA</span>,<span class="number">32</span>,<span class="number">123</span>,<span class="number">0x76</span>,<span class="number">0x61</span>,<span class="number">0x7257</span>/<span class="number">0400</span>,_$rQE(<span class="number">3009</span>),<span class="number">0141</span>,<span class="number">97</span>,</span><br><span class="line"><span class="number">0x0</span>|<span class="number">0x20</span>,<span class="number">61</span>,<span class="number">32</span>,<span class="number">97</span>,<span class="number">0162</span>,~~<span class="number">103</span>,~~<span class="number">117</span>,<span class="number">109</span>,<span class="number">1010</span>/<span class="number">0xA</span>,~(<span class="number">0x6e</span>^<span class="number">-1</span>),</span><br><span class="line"><span class="number">-1</span>-~(<span class="number">0x74</span>^<span class="number">0</span>),<span class="number">115</span>,~~<span class="number">91</span>,<span class="number">48</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),_$ldXO(<span class="number">3705</span>),<span class="number">59</span>,<span class="number">1183</span>/<span class="number">0xA</span>,<span class="number">97</span>,<span class="number">1147</span>/<span class="number">0xA</span>,<span class="number">32</span>,</span><br><span class="line">_$<span class="number">4</span>qj(~~<span class="number">434</span>),_$fgfk(~~<span class="number">268</span>),<span class="number">0x0</span>|<span class="number">0x60</span>,<span class="built_in">Math</span>.abs(<span class="number">32</span>)&amp;<span class="number">-1</span>,~~<span class="number">38</span>,<span class="number">44</span>,<span class="number">-1</span>-~(<span class="number">0x66</span>^<span class="number">0</span>),<span class="number">1115</span>/<span class="number">0xA</span>,<span class="number">0x72</span>,<span class="number">32</span>,</span><br><span class="line"><span class="number">0x2892</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">118</span>,~~<span class="number">97</span>,~~<span class="number">114</span>,<span class="number">0x2043</span>/<span class="number">0400</span>,<span class="number">0x6943</span>/<span class="number">0400</span>,<span class="number">0x0</span>|<span class="number">0x20</span>,<span class="number">613</span>/<span class="number">0xA</span>,<span class="number">32</span>,<span class="number">49</span>,</span><br><span class="line"><span class="number">59</span>,<span class="number">32</span>,<span class="number">-1</span>-~(<span class="number">0x69</span>^<span class="number">0</span>),<span class="number">0x2029</span>/<span class="number">0400</span>,<span class="number">60</span>,<span class="number">96</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),_$fgfk(<span class="number">0x14e88</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>),~~<span class="number">55</span>,<span class="number">0x0</span>|<span class="number">0x26</span>,<span class="number">46</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),</span><br><span class="line"><span class="number">0x6c04</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">0x6513</span>/<span class="number">0400</span>,~~<span class="number">110</span>,<span class="number">103</span>,<span class="number">116</span>,<span class="number">104</span>,<span class="number">59</span>,<span class="number">32</span>,~~<span class="number">105</span>,<span class="number">0x2b</span>,</span><br><span class="line">~~<span class="number">43</span>,~~<span class="number">41</span>,<span class="number">32</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),~~<span class="number">123</span>,~(<span class="number">0x69</span>^<span class="number">-1</span>),<span class="number">0x6660</span>/<span class="number">0400</span>,<span class="number">32</span>,<span class="number">40</span>,<span class="number">105</span>,<span class="number">0x2033</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,</span><br><span class="line"><span class="number">37</span>,<span class="number">0x2000</span>/<span class="number">0400</span>,~(<span class="number">0x32</span>^<span class="number">-1</span>),<span class="number">329</span>/<span class="number">0xA</span>,<span class="number">61</span>,<span class="number">61</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),_$fgfk(~~<span class="number">334</span>),~(<span class="number">0x30</span>^<span class="number">-1</span>),<span class="number">41</span>,<span class="number">32</span>,</span><br><span class="line">~(<span class="number">0x7b</span>^<span class="number">-1</span>),<span class="number">96</span>,~(<span class="number">0x20</span>^<span class="number">-1</span>),_$uX0(<span class="number">0xf6c</span>),<span class="number">0x2155</span>/<span class="number">0400</span>,<span class="number">98</span>,<span class="number">98</span>,_$rQE(<span class="number">-1</span>-~(<span class="number">0xbc1</span>^<span class="number">0</span>)),<span class="number">45</span>,_$ldXO(<span class="built_in">Math</span>.abs(<span class="number">3652</span>)&amp;<span class="number">-1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+__sOVO(<span class="number">-1</span>-~(<span class="number">0x20</span>^<span class="number">0</span>),<span class="number">105</span>,<span class="number">399</span>/<span class="number">0xA</span>,<span class="number">105</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="built_in">Math</span>.abs(<span class="number">93</span>)&amp;<span class="number">-1</span>,<span class="number">0x3b28</span>/<span class="number">0400</span>,<span class="number">125</span>,<span class="number">-1</span>-~(<span class="number">0x20</span>^<span class="number">0</span>),<span class="number">101</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">0x6c62</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,</span><br><span class="line"><span class="number">1152</span>/<span class="number">0xA</span>,<span class="number">0x65</span>,<span class="built_in">Math</span>.abs(<span class="number">96</span>)&amp;<span class="number">-1</span>,<span class="number">32</span>,<span class="number">065</span>,<span class="built_in">Math</span>.abs(<span class="number">38</span>)&amp;<span class="number">-1</span>,<span class="number">43</span>,<span class="number">96</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">328</span>/<span class="number">0xA</span>,<span class="number">0x3034</span>/<span class="number">0400</span>,</span><br><span class="line"><span class="number">053</span>,<span class="number">96</span>,<span class="number">040</span>,<span class="built_in">Math</span>.abs(<span class="number">98</span>)&amp;<span class="number">-1</span>,<span class="number">-1</span>-~(<span class="number">0x5c</span>^<span class="number">0</span>),~(<span class="number">0x22</span>^<span class="number">-1</span>),<span class="number">0x3d</span>,<span class="number">61</span>,<span class="built_in">Math</span>.abs(<span class="number">32</span>)&amp;<span class="number">-1</span>,<span class="number">52</span>,</span><br><span class="line"><span class="number">0x6000</span>/<span class="number">0400</span>,<span class="number">323</span>/<span class="number">0xA</span>,~(<span class="number">0x43</span>^<span class="number">-1</span>),~(<span class="number">0x3d</span>^<span class="number">-1</span>),<span class="number">0140</span>,<span class="number">-1</span>-~(<span class="number">0x20</span>^<span class="number">0</span>),_$fgfk(<span class="number">0x12c43</span>/<span class="number">0400</span>),_$rQE(<span class="number">3012</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>)),<span class="number">55</span>,<span class="number">0x0</span>|<span class="number">0x60</span>,</span><br><span class="line"><span class="number">040</span>,<span class="built_in">Math</span>.abs(<span class="number">64</span>)&amp;<span class="number">-1</span>,~(<span class="number">0x27</span>^<span class="number">-1</span>),_$uX0(<span class="number">0xf6677</span>/<span class="number">0400</span>),<span class="number">32</span>,<span class="number">96</span>,_$fgfk(<span class="number">322</span>),<span class="number">96</span>,<span class="number">0x0</span>|<span class="number">0x20</span>,<span class="number">60</span>,</span><br><span class="line">~(<span class="number">0x2b</span>^<span class="number">-1</span>),~~<span class="number">49</span>,<span class="built_in">Math</span>.abs(<span class="number">53</span>)&amp;<span class="number">-1</span>,_$uX0(<span class="number">3942</span>),_$ldXO(<span class="number">0xe04</span>),~~<span class="number">63</span>,<span class="built_in">Math</span>.abs(<span class="number">41</span>)&amp;<span class="number">-1</span>,<span class="number">0151</span>,<span class="number">96</span>,<span class="number">041</span>,</span><br><span class="line">~~<span class="number">38</span>,<span class="number">392</span>/<span class="number">0xA</span>,~(<span class="number">0x33</span>^<span class="number">-1</span>),~(<span class="number">0x60</span>^<span class="number">-1</span>),<span class="number">33</span>,<span class="number">127</span>,<span class="number">0x2331</span>/<span class="number">0400</span>,<span class="number">-1</span>-~(<span class="number">0x74</span>^<span class="number">0</span>),<span class="number">0x7950</span>/<span class="number">0400</span>,<span class="number">0x0</span>|<span class="number">0x70</span>,</span><br><span class="line"><span class="number">101</span>,<span class="number">-1</span>-~(<span class="number">0x6f</span>^<span class="number">0</span>),<span class="number">102</span>,<span class="number">326</span>/<span class="number">0xA</span>,~~<span class="number">108</span>,~(<span class="number">0x6f</span>^<span class="number">-1</span>),~~<span class="number">99</span>,<span class="number">97</span>,<span class="number">96</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">35</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),</span><br><span class="line">_$<span class="number">4</span>qj(<span class="number">0x1e2</span>),<span class="number">0x21</span>,<span class="number">0x2133</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">075</span>,<span class="number">32</span>,<span class="number">927</span>/<span class="number">0xA</span>,<span class="number">34</span>,<span class="number">117</span>,~~<span class="number">110</span>,<span class="number">0144</span>,</span><br><span class="line"><span class="number">0x6524</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">0x6672</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">0x6918</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">110</span>,<span class="number">-1</span>-~(<span class="number">0x65</span>^<span class="number">0</span>),<span class="number">100</span>,_$fgfk(~~<span class="number">306</span>),<span class="number">0x0</span>|<span class="number">0x22</span>,_$uX0(<span class="number">3878</span>),<span class="built_in">Math</span>.abs(<span class="number">38</span>)&amp;<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+__sOVO(~~<span class="number">38</span>,<span class="built_in">Math</span>.abs(<span class="number">32</span>)&amp;<span class="number">-1</span>,<span class="number">96</span>,~(<span class="number">0x20</span>^<span class="number">-1</span>),~~<span class="number">51</span>,<span class="number">43</span>,<span class="number">468</span>/<span class="number">0xA</span>,<span class="number">0x68</span>,<span class="number">0157</span>,<span class="number">115</span>,</span><br><span class="line"><span class="built_in">Math</span>.abs(<span class="number">116</span>)&amp;<span class="number">-1</span>,<span class="number">0x0</span>|<span class="number">0x6e</span>,~(<span class="number">0x61</span>^<span class="number">-1</span>),<span class="number">0x0</span>|<span class="number">0x6d</span>,~~<span class="number">101</span>,<span class="number">0x0</span>|<span class="number">0x20</span>,<span class="number">61</span>,<span class="number">61</span>,<span class="number">040</span>,<span class="number">0x5c22</span>/<span class="number">0400</span>,</span><br><span class="line"><span class="number">042</span>,<span class="number">1156</span>/<span class="number">0xA</span>,<span class="number">0x7435</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">114</span>,<span class="built_in">Math</span>.abs(<span class="number">105</span>)&amp;<span class="number">-1</span>,<span class="number">110</span>,<span class="number">0x6742</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">96</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">320</span>/<span class="number">0xA</span>,~(<span class="number">0x43</span>^<span class="number">-1</span>),</span><br><span class="line"><span class="number">33</span>,<span class="number">0x60</span>,<span class="number">0x2081</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">0x3041</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">45</span>,_$<span class="number">4</span>qj(<span class="number">0x1fe88</span>/<span class="number">0400</span>),<span class="number">0155</span>,<span class="number">0x6128</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">116</span>,~(<span class="number">0x63</span>^<span class="number">-1</span>),</span><br><span class="line"><span class="number">0x6854</span>/<span class="number">0400</span>,_$fgfk(<span class="number">0506</span>),_$rQE(<span class="number">3005</span>),~~<span class="number">34</span>,<span class="number">1017</span>/<span class="number">0xA</span>,<span class="number">0x6c</span>,~~<span class="number">111</span>,<span class="number">110</span>,<span class="number">103</span>,<span class="number">-1</span>-~(<span class="number">0x5c</span>^<span class="number">0</span>),</span><br><span class="line"><span class="number">0x2211</span>/<span class="number">0400</span>,<span class="number">41</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">41</span>,<span class="number">321</span>/<span class="number">0xA</span>,<span class="number">123</span>,~~<span class="number">96</span>,<span class="number">-1</span>-~(<span class="number">0x24</span>^<span class="number">0</span>),<span class="number">0x0</span>|<span class="number">0x25</span>,~(<span class="number">0x5c</span>^<span class="number">-1</span>),<span class="number">0x2237</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,</span><br><span class="line"><span class="number">0x0</span>|<span class="number">0x61</span>,<span class="built_in">Math</span>.abs(<span class="number">96</span>)&amp;<span class="number">-1</span>,<span class="number">92</span>,<span class="number">0x2257</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">110</span>,<span class="built_in">Math</span>.abs(<span class="number">52</span>)&amp;<span class="number">-1</span>,<span class="number">96</span>,<span class="number">32</span>,<span class="number">53</span>,<span class="number">38</span>,</span><br><span class="line"><span class="number">0x69</span>,<span class="number">59</span>,~~<span class="number">96</span>,~(<span class="number">0x5c</span>^<span class="number">-1</span>),<span class="number">34</span>,<span class="number">426</span>/<span class="number">0xA</span>,<span class="number">0x3466</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">-1</span>-~(<span class="number">0x60</span>^<span class="number">0</span>),<span class="number">92</span>,<span class="number">34</span>,</span><br><span class="line">~(<span class="number">0x33</span>^<span class="number">-1</span>),_$fgfk(<span class="number">322</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>)),<span class="number">54</span>,<span class="number">0x60</span>,<span class="number">0x20</span>,<span class="number">0x5d37</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="built_in">Math</span>.abs(<span class="number">54</span>)&amp;<span class="number">-1</span>,<span class="number">968</span>/<span class="number">0xA</span>,<span class="number">044</span>,~~<span class="number">125</span>,</span><br><span class="line"><span class="number">0x5c</span>,_$fgfk(<span class="number">0x14c11</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>),<span class="number">97</span>,_$uX0(<span class="number">3942</span>),<span class="number">0x5c90</span>/<span class="number">0400</span>,<span class="number">0x0</span>|<span class="number">0x22</span>,<span class="number">-1</span>-~(<span class="number">0x65</span>^<span class="number">0</span>),<span class="number">45</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">57</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">96</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+__sOVO(~~<span class="number">92</span>,~~<span class="number">34</span>,<span class="number">0145</span>,<span class="number">44</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),~~<span class="number">96</span>,_$<span class="number">4</span>qj(<span class="built_in">Math</span>.abs(<span class="number">499</span>)&amp;<span class="number">-1</span>),<span class="number">389</span>/<span class="number">0xA</span>,<span class="built_in">Math</span>.abs(<span class="number">44</span>)&amp;<span class="number">-1</span>,<span class="number">0x60</span>,_$ldXO(~(<span class="number">0xe78</span>^<span class="number">-1</span>)),</span><br><span class="line"><span class="number">345</span>/<span class="number">0xA</span>,<span class="number">65</span>,<span class="number">-1</span>-~(<span class="number">0x57</span>^<span class="number">0</span>),<span class="number">-1</span>-~(<span class="number">0x72</span>^<span class="number">0</span>),_$ldXO(<span class="built_in">Math</span>.abs(<span class="number">3649</span>)&amp;<span class="number">-1</span>),<span class="number">102</span>,<span class="number">96</span>,<span class="number">92</span>,<span class="number">34</span>,<span class="number">94</span>,</span><br><span class="line"><span class="number">54</span>,~(<span class="number">0x72</span>^<span class="number">-1</span>),<span class="number">101</span>,<span class="number">0146</span>,~(<span class="number">0x60</span>^<span class="number">-1</span>),<span class="number">92</span>,<span class="number">34</span>,<span class="number">0x4391</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">77</span>,<span class="number">96</span>,</span><br><span class="line"><span class="number">0x2502</span>/<span class="number">0400</span>,<span class="number">0x3e49</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="built_in">Math</span>.abs(<span class="number">51</span>)&amp;<span class="number">-1</span>,<span class="number">96</span>,<span class="number">0x2049</span>/<span class="number">0400</span>,<span class="number">78</span>,<span class="number">044</span>,<span class="number">96</span>,<span class="built_in">Math</span>.abs(<span class="number">33</span>)&amp;<span class="number">-1</span>,<span class="number">0x0</span>|<span class="number">0x7b</span>,</span><br><span class="line"><span class="number">041</span>,<span class="built_in">Math</span>.abs(<span class="number">96</span>)&amp;<span class="number">-1</span>,<span class="number">0x0</span>|<span class="number">0x21</span>,~~<span class="number">112</span>,<span class="number">0x0</span>|<span class="number">0x2d</span>,<span class="number">541</span>/<span class="number">0xA</span>,<span class="number">96</span>,~(<span class="number">0x21</span>^<span class="number">-1</span>),<span class="number">115</span>,<span class="number">0x2a</span>,</span><br><span class="line">_$<span class="number">4</span>qj(<span class="number">0664</span>),<span class="number">0x6f98</span>/<span class="number">0400</span>,_$rQE(<span class="number">2946</span>),<span class="number">96</span>,<span class="number">32</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">85</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">0x21</span>,<span class="number">960</span>/<span class="number">0xA</span>,<span class="number">0x2178</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">110</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),</span><br><span class="line"><span class="number">47</span>,_$fgfk(<span class="number">0x10e65</span>/<span class="number">0400</span>),<span class="number">0x2097</span>/<span class="number">0400</span>,<span class="number">51</span>,<span class="number">0x2c00</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,~~<span class="number">46</span>,<span class="number">-1</span>-~(<span class="number">0x63</span>^<span class="number">0</span>),<span class="number">114</span>,<span class="number">101</span>,<span class="number">970</span>/<span class="number">0xA</span>,</span><br><span class="line">_$<span class="number">4</span>qj(~(<span class="number">0x1a4</span>^<span class="number">-1</span>)),<span class="number">-1</span>-~(<span class="number">0x65</span>^<span class="number">0</span>),<span class="number">0x4581</span>/<span class="number">0400</span>,<span class="built_in">Math</span>.abs(<span class="number">108</span>)&amp;<span class="number">-1</span>,<span class="number">101</span>,<span class="number">0140</span>,<span class="number">320</span>/<span class="number">0xA</span>,<span class="number">76</span>,<span class="number">0x2193</span>/<span class="number">0400</span>,<span class="number">0x3d</span>,</span><br><span class="line"><span class="number">61</span>,<span class="number">0x2078</span>/<span class="number">0400</span>,<span class="number">0x5c08</span>/<span class="number">0400</span>,<span class="built_in">Math</span>.abs(<span class="number">34</span>)&amp;<span class="number">-1</span>,~~<span class="number">96</span>,<span class="number">0x2888</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,_$fgfk(<span class="number">260</span>),<span class="number">36</span>,<span class="number">92</span>,<span class="number">0x0</span>|<span class="number">0x22</span>,</span><br><span class="line"><span class="number">320</span>/<span class="number">0xA</span>,_$fgfk(<span class="number">0x11236</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>),<span class="number">0x7c25</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">96</span>,<span class="number">0x5c11</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">0x0</span>|<span class="number">0x22</span>,_$fgfk(<span class="number">295</span>),<span class="number">36</span>,<span class="number">96</span>,~(<span class="number">0x20</span>^<span class="number">-1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+__sOVO(_$<span class="number">4</span>qj(<span class="built_in">Math</span>.abs(<span class="number">484</span>)&amp;<span class="number">-1</span>),_$fgfk(<span class="number">-1</span>-~(<span class="number">0x159</span>^<span class="number">0</span>)),<span class="number">1117</span>/<span class="number">0xA</span>,~(<span class="number">0x62</span>^<span class="number">-1</span>),<span class="number">0x6a27</span>/<span class="number">0400</span>,<span class="number">101</span>,~(<span class="number">0x63</span>^<span class="number">-1</span>),<span class="number">116</span>,<span class="number">962</span>/<span class="number">0xA</span>,~(<span class="number">0x5c</span>^<span class="number">-1</span>),</span><br><span class="line"><span class="number">0x22</span>,<span class="number">54</span>,<span class="number">33</span>,<span class="number">0x60</span>,<span class="number">0x2386</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,~(<span class="number">0x7a</span>^<span class="number">-1</span>),~(<span class="number">0x23</span>^<span class="number">-1</span>),<span class="number">96</span>,~(<span class="number">0x21</span>^<span class="number">-1</span>),<span class="number">0x0</span>|<span class="number">0x7e</span>,</span><br><span class="line">_$<span class="number">4</span>qj(<span class="number">0x1e903</span>/<span class="number">0400</span>),_$fgfk(<span class="number">270</span>),~(<span class="number">0x21</span>^<span class="number">-1</span>),<span class="number">-1</span>-~(<span class="number">0x7f</span>^<span class="number">0</span>),_$ldXO(<span class="built_in">Math</span>.abs(<span class="number">3589</span>)&amp;<span class="number">-1</span>),<span class="number">96</span>,<span class="number">0x2418</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>,<span class="number">0x6e</span>,~(<span class="number">0x31</span>^<span class="number">-1</span>),_$ldXO(<span class="number">0xe4445</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>),</span><br><span class="line">_$<span class="number">4</span>qj(<span class="number">0x1f061</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>),<span class="number">0x0</span>|<span class="number">0x38</span>,<span class="number">36</span>&amp;(<span class="number">-1</span>^<span class="number">0x00</span>),<span class="number">59</span>,<span class="number">125</span>,<span class="number">125</span>,<span class="number">96</span>,<span class="number">42</span>,_$uX0(<span class="number">0xf3d14</span>&gt;&gt;<span class="number">4</span>&gt;&gt;<span class="number">4</span>),_$ldXO(<span class="number">3591</span>),</span><br><span class="line"><span class="number">-1</span>-~(<span class="number">0x62</span>^<span class="number">0</span>),<span class="number">98</span>,_$rQE(<span class="number">0x0</span>|<span class="number">0xbda</span>),_$uX0(<span class="number">0xf7b</span>),<span class="number">34</span>,~~<span class="number">41</span>,<span class="number">-1</span>-~(<span class="number">0x29</span>^<span class="number">0</span>)));</span><br></pre></td></tr></table></figure>
<p>通过对<code>__sOVO</code>函数的入参打印，我们发现在<code>node.js</code>环境里和在x龙的网站入参是一样的，我们进一步过滤脚本，得到了一个更加清晰的版本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execute();<span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params"></span>) </span>&#123;<span class="keyword">try</span> &#123;            <span class="keyword">return</span> d(<span class="number">7856174</span>, <span class="number">619</span>, <span class="number">716</span>, <span class="number">539</span>, <span class="number">872</span>, <span class="number">291</span>, <span class="number">894</span>, <span class="number">763</span>, <span class="number">181</span>, <span class="number">892</span>, <span class="number">911</span>, <span class="number">291</span>, <span class="number">812</span>, <span class="number">154</span>, <span class="number">752</span>, <span class="number">521</span>, <span class="number">894</span>, <span class="number">617</span>, <span class="number">369</span>, <span class="number">187</span>, <span class="number">524</span>);&#125; <span class="keyword">catch</span> (e)  <span class="keyword">return</span> <span class="number">-99</span>;&#125;&#125;cute() &#123;td() &#123;<span class="keyword">var</span> aa = <span class="built_in">arguments</span>[<span class="number">0</span>];<span class="keyword">var</span> bb = <span class="built_in">arguments</span>[<span class="number">0</span>];<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; <span class="built_in">arguments</span>.length; i++) &#123;<span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) &#123;bb = bb - <span class="built_in">arguments</span>[i];&#125; <span class="keyword">else</span> &#123;bb = bb + <span class="built_in">arguments</span>[i];&#125;<span class="keyword">if</span> (i == <span class="number">4</span>) &#123;bb = bb - <span class="built_in">arguments</span>[i];&#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">7</span>) &#123;bb = bb + <span class="built_in">arguments</span>[i];&#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">15</span>) &#123;bb = bb + i;&#125;<span class="keyword">if</span> (i == <span class="number">3</span>) &#123;<span class="keyword">if</span> (<span class="keyword">typeof</span> loca() &#123;t!= <span class="string">"undefined"</span> &amp;&amp; <span class="keyword">typeof</span> loca() &#123;.hostname == <span class="string">"string"</span> &amp;&amp; loca() &#123;.hostname.match(<span class="string">"elong"</span>)) &#123;aa = aa - <span class="built_in">arguments</span>[i];&#125; <span class="keyword">else</span> &#123;aa = aa - i;bb = bb + <span class="built_in">arguments</span>[i];&#125;&#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">6</span>) &#123;aa = aa - <span class="built_in">arguments</span>[i];bb = aa;&#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">9</span>) &#123;bb = bb + i;&#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">13</span>) &#123;<span class="keyword">if</span> (<span class="keyword">typeof</span> loca() &#123;t!= <span class="string">"undefined"</span> &amp;&amp; <span class="keyword">typeof</span> loca() &#123;.href == <span class="string">"string"</span> &amp;&amp; loca() &#123;.href.match(<span class="string">"elong"</span>)) &#123;aa = aa - <span class="built_in">arguments</span>[i];&#125; <span class="keyword">else</span> &#123;bb = bb - <span class="built_in">arguments</span>[i];aa = aa + i;&#125;&#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">16</span>) &#123;<span class="keyword">if</span> (<span class="keyword">typeof</span> documentt!= <span class="string">"undefined"</span> &amp;&amp; (<span class="keyword">typeof</span> <span class="built_in">document</span>.createElementt== <span class="string">"cute() &#123;"</span> || <span class="keyword">typeof</span> <span class="built_in">document</span>.createElementt== <span class="string">"object"</span>)) &#123;bb = aa - <span class="built_in">arguments</span>[i];&#125; <span class="keyword">else</span> &#123;bb = aa + <span class="built_in">arguments</span>[i];&#125;&#125; <span class="keyword">else</span> &#123;bb = aa;&#125;&#125;<span class="keyword">return</span> bb;&#125;</span><br></pre></td></tr></table></figure>
<p>从上面的代码里我们看到了，在脚本里，进行了判断<code>location.href</code>，<code>location.hostname</code>这些是否包含<code>x龙</code>，同时还判断了<code>document.createElement</code>是否是函数等等，至此我们明白了为什么之前我们node.js环境和本地浏览器环境为什么和x龙网站上算出的<code>code</code>码不同了。</p>
<p>于是我们在<code>node.js</code>的环境加上这些浏览器的特性之后，惊喜的发现，我们算出的<code>code</code>码和x龙网站上算出的是一样的，至此x龙的防爬系统终于告破，下面我们用一个简单的工程来抓取页面吧。</p>
<p>抓取系统分两块，<code>nodejs</code>部分监听一个端口，用来接收请求，算出<code>code</code>码，<code>python</code>部分负责请求接口，抓取数据。因为破解这个脚本要使用<code>eval</code>函数，所以怕脚本投毒，我们利用一个<code>vm</code>沙盒来运行破解脚本，万一被x龙投毒，<code>rm -rf /</code>执行这个就玩完了。</p>
<p>先放上计算<code>code</code>的脚本函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">aesStr, hotelId, checkIn, checkOut</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> location = &#123;</span><br><span class="line">            <span class="comment">// 这里只是放置使用到的一些 location 的函数</span></span><br><span class="line">            <span class="comment">// 可能防爬系统里还有其他 location 属性判断，只需要都定义一下即可，或者设置一个gettar</span></span><br><span class="line">            hostname : <span class="string">'hotel.elong.com'</span>,</span><br><span class="line">            href :<span class="string">'hotel.elong.com'</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> <span class="built_in">document</span> = &#123;    </span><br><span class="line">            <span class="comment">// 这里只是放置使用到的一些 document 的函数</span></span><br><span class="line">            <span class="comment">// 可能防爬系统里还有其他 document 属性判断，只需要都定义一下即可，或者设置一个gettar</span></span><br><span class="line">            createElement : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> getDateString = <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> c=a.getMonth()+<span class="number">1</span>,d=a.getDate(),</span><br><span class="line">            e=c&gt;<span class="number">9</span>?c.toString():<span class="string">"0"</span>+c.toString(),</span><br><span class="line">            f=d&gt;<span class="number">9</span>?d.toString():<span class="string">"0"</span>+d.toString(),</span><br><span class="line">            g=b?e+<span class="string">"/"</span>+f+<span class="string">"/"</span>+a.getFullYear():a.getFullYear().toString()+<span class="string">"-"</span>+e+<span class="string">"-"</span>+f;</span><br><span class="line">            <span class="keyword">return</span> g</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> isNull = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">"undefined"</span> == <span class="keyword">typeof</span> a || <span class="literal">null</span> === a</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> trim = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> a.replace(<span class="regexp">/(^[\s　]*)|([\s　]*$)/g</span>, <span class="string">""</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> empty = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">""</span> === trim(a)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> isNullOrEmpty =  <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">void</span> <span class="number">0</span> === a || <span class="literal">null</span> === a || empty(a)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> stringToDate = <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!b)<span class="keyword">var</span> b=!<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">var</span> c=(reFormatDateString(a,b),getDateArray(a));</span><br><span class="line">            <span class="keyword">return</span> c&amp;&amp;c.year&amp;&amp;c.month&amp;&amp;c.day?<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">parseInt</span>(c.year,<span class="number">10</span>),<span class="built_in">parseInt</span>(c.month,<span class="number">10</span>)<span class="number">-1</span>,<span class="built_in">parseInt</span>(c.day,<span class="number">10</span>)):<span class="keyword">void</span> <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> reFormatDateString = <span class="function"><span class="keyword">function</span>(<span class="params">a,c</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> d=getDateArray(a),e=d.year,f=d.month,g=d.day;</span><br><span class="line">            <span class="keyword">return</span> isNull(d)||isNullOrEmpty(a)?<span class="string">""</span>:(d.year.length&lt;=<span class="number">2</span>&amp;&amp;(e=<span class="string">"19"</span>+d.year),<span class="number">1</span>==d.month.length&amp;&amp;(f=<span class="string">"0"</span>+d.month),<span class="number">1</span>==d.day.length&amp;&amp;(g=<span class="string">"0"</span>+d.day),isNull(c)||c?e+<span class="string">"-"</span>+f+<span class="string">"-"</span>+g:f+<span class="string">"/"</span>+g+<span class="string">"/"</span>+e)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> getDateArray = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">var</span> c,d,e,f=<span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">3</span>);</span><br><span class="line">                <span class="keyword">if</span>(isNullOrEmpty(a)) <span class="keyword">return</span><span class="string">""</span>;</span><br><span class="line">                <span class="keyword">if</span>(a.indexOf(<span class="string">"-"</span>)&gt;<span class="number">-1</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(f=a.split(<span class="string">"-"</span>),<span class="number">3</span>!=f.length) <span class="keyword">return</span><span class="string">""</span>;c=f[<span class="number">0</span>],d=f[<span class="number">1</span>],e=f[<span class="number">2</span>]</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">if</span>(f=a.split(<span class="string">"/"</span>),<span class="number">3</span>!=f.length) <span class="keyword">return</span><span class="string">""</span>;</span><br><span class="line">                    c=f[<span class="number">2</span>],d=f[<span class="number">0</span>],e=f[<span class="number">1</span>]&#125;   <span class="keyword">return</span> &#123;<span class="attr">year</span>:c,<span class="attr">month</span>:d,<span class="attr">day</span>:e&#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">abcdefg</span>(<span class="params">dynamicScript, type</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> == dynamicScript || dynamicScript == <span class="string">''</span> || dynamicScript == <span class="string">'$&#123;tsd&#125;'</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">-99</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">var</span> script = hijklmn(dynamicScript, type);</span><br><span class="line">                <span class="keyword">var</span> code = <span class="built_in">eval</span>(script);</span><br><span class="line">                <span class="keyword">return</span> code</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(e)</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-99</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">hijklmn</span>(<span class="params">script, type</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> == script || script == <span class="string">''</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> script</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> decScript = lmnopq(script, qwertyui(type));</span><br><span class="line">            <span class="keyword">var</span> result = decScript.replace(<span class="regexp">/\)\^-1/gm</span>, <span class="string">")&amp;-1"</span>);</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">lmnopq</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> keyHex = CryptoJS.enc.Utf8.parse(b);</span><br><span class="line">            <span class="built_in">console</span>.log(b,keyHex)</span><br><span class="line">            <span class="built_in">console</span>.log()</span><br><span class="line">            <span class="keyword">var</span> decrypted = CryptoJS.DES.decrypt(&#123;</span><br><span class="line">                ciphertext: CryptoJS.enc.Base64.parse(a)</span><br><span class="line">            &#125;, keyHex, &#123;</span><br><span class="line">                mode: CryptoJS.mode.ECB,</span><br><span class="line">                padding: CryptoJS.pad.Pkcs7</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">var</span> c = decrypted.toString(CryptoJS.enc.Utf8);</span><br><span class="line">            <span class="keyword">return</span> c</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">qwertyui</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (type === <span class="string">'list'</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> key = getFormatDateString(pageController.requestInfo.checkInDate) + pageController.requestInfo.cityID + getFormatDateString(pageController.requestInfo.checkOutDate)</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'detail'</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> key = getFormatDateString(checkIn) + hotelId + getFormatDateString(checkOut)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">var</span> key = pageController.detailRequest.hotelIDs</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">console</span>.log(key)</span><br><span class="line">            <span class="keyword">return</span> abcdef(key)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">qwertyuir</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (type === <span class="string">'list'</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> key = getFormatDateString(pageController.requestInfo.checkInDate) + pageController.requestInfo.firstHotelInfo + getFormatDateString(pageController.requestInfo.checkOutDate)</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'detail'</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> key = getFormatDateString(pageController.detailRequest.checkInDate) + pageController.detailRequest.customerLevel + getFormatDateString(pageController.detailRequest.checkOutDate)</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'comment'</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> key = pageController.detailRequest.hotelIDs + pageController.detailRequest.customerLevel</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> abcdef(key)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">getFormatDateString</span>(<span class="params">dateString</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> getDateString(stringToDate(dateString))</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(e)</span><br><span class="line">                <span class="keyword">return</span> dateString</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">abcdef</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> hashCode = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> value != <span class="literal">undefined</span> &amp;&amp; value != <span class="literal">null</span> &amp;&amp; value != <span class="string">""</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> code = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; value.length; i++) &#123;</span><br><span class="line">                    code = value.charCodeAt(i);</span><br><span class="line">                    hashCode = ((hashCode &lt;&lt; <span class="number">5</span>) - hashCode) + code;</span><br><span class="line">                    hashCode = hashCode &amp; hashCode</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> hashString = hashCode.toString();</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">8</span>).join(<span class="string">'e'</span>) + hashString).slice(<span class="number">-8</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">abcdefh</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> hashCode = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> value != <span class="literal">undefined</span> &amp;&amp; value != <span class="literal">null</span> &amp;&amp; value != <span class="string">""</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> code = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; value.length; i++) &#123;</span><br><span class="line">                    code = value.charCodeAt(i);</span><br><span class="line">                    hashCode = ((hashCode &lt;&lt; <span class="number">5</span>) - hashCode) + code;</span><br><span class="line">                    hashCode = hashCode &amp; hashCode</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> hashString = hashCode.toString();</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">8</span>).join(<span class="string">'r'</span>) + hashString).slice(<span class="number">-8</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// root.getCheckCodeByType = abcdefg;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> x = abcdefg(aesStr, <span class="string">'detail'</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(x);</span><br><span class="line">        code = x</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们启动一个<code>node.js</code>的程序，来监听端口，用来接收<code>python</code>的请求，算出伪造的<code>code</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"><span class="keyword">const</span> CryptoJS = <span class="built_in">require</span>(<span class="string">'crypto-js'</span>);</span><br><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">'vm'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> codeStr = <span class="built_in">require</span>(<span class="string">'./cheat_elong.js'</span>).toString();</span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(codeStr)</span></span><br><span class="line"></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;)); <span class="comment">// for parsing application/x-www-form-urlencoded</span></span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/getelongcode'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  	</span><br><span class="line">    <span class="comment">// 接收参数，计算</span></span><br><span class="line">  	<span class="keyword">const</span> code = req.body.code</span><br><span class="line">  	<span class="keyword">const</span> hotelid = req.body.hotelid</span><br><span class="line">  	<span class="keyword">const</span> checkin = req.body.checkin</span><br><span class="line">  	<span class="keyword">const</span> checkout = req.body.checkout</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> sandbox = &#123; </span><br><span class="line">		<span class="built_in">require</span>: <span class="literal">null</span>, </span><br><span class="line">		CryptoJS:CryptoJS,</span><br><span class="line">		code:<span class="string">''</span>,</span><br><span class="line">		<span class="built_in">console</span>:<span class="built_in">console</span>,</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// console.log(hotelid, checkin, checkout, code)</span></span><br><span class="line">	<span class="keyword">const</span> runStr = <span class="string">`(<span class="subst">$&#123;codeStr&#125;</span>)('<span class="subst">$&#123;code&#125;</span>','<span class="subst">$&#123;hotelid&#125;</span>','<span class="subst">$&#123;checkin&#125;</span>','<span class="subst">$&#123;checkout&#125;</span>')`</span></span><br><span class="line">	</span><br><span class="line">  	vm.runInNewContext(runStr, sandbox);    <span class="comment">// 利用vm沙盒保证eval不会穿透</span></span><br><span class="line"></span><br><span class="line">  	<span class="built_in">console</span>.log(sandbox.code)</span><br><span class="line">  	res.send(<span class="string">`<span class="subst">$&#123;sandbox.code&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<p>最后，我们使用<code>python</code>脚本来串起来整个抓取过程，并把结果保存到<code>csv</code>文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> Cookie</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> urlencode</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trans</span><span class="params">(jsonData,hotelId)</span>:</span></span><br><span class="line">    csvfile = open(<span class="string">'elonghotel_'</span>+ hotelId +<span class="string">'.csv'</span>, <span class="string">'wb+'</span>) <span class="comment"># python3下</span></span><br><span class="line">    writer = csv.writer(csvfile)</span><br><span class="line">    flag = <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">for</span> dic <span class="keyword">in</span> jsonData:</span><br><span class="line">        <span class="keyword">if</span> flag:</span><br><span class="line">            <span class="comment"># 获取属性列表</span></span><br><span class="line">            keys = list(dic.keys())</span><br><span class="line">            <span class="keyword">print</span> (keys)</span><br><span class="line">            writer.writerow(keys) <span class="comment"># 将属性列表写入csv中</span></span><br><span class="line">            flag = <span class="keyword">False</span></span><br><span class="line">        <span class="comment"># 读取json数据的每一行，将values数据一次一行的写入csv中</span></span><br><span class="line">        writer.writerow(list(dic.values()))</span><br><span class="line">    csvfile.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(str=<span class="string">''</span>)</span>:</span></span><br><span class="line">    hl = hashlib.md5()</span><br><span class="line">    hl.update(str.encode(encoding=<span class="string">'utf-8'</span>))</span><br><span class="line">    <span class="keyword">return</span> hl.hexdigest()</span><br><span class="line"></span><br><span class="line">HOTELID = <span class="string">'90933821'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">createUa</span><span class="params">()</span>:</span></span><br><span class="line">    s0 = numpy.random.randint(<span class="number">100</span>,<span class="number">537</span>)</span><br><span class="line">    s1 = numpy.random.randint(<span class="number">10</span>,<span class="number">36</span>)</span><br><span class="line">    s2 = numpy.random.randint(<span class="number">55</span>,<span class="number">67</span>)</span><br><span class="line">    s3 = numpy.random.randint(<span class="number">3000</span>,<span class="number">3396</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/&#123;0&#125;.&#123;1&#125; (KHTML, like Gecko) Chrome/&#123;2&#125;.0.&#123;3&#125;.79 Safari/537.36'</span>.format(</span><br><span class="line">        s0,s1,s2,s3</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">queryDict = &#123;</span><br><span class="line">  <span class="string">'code'</span>:<span class="string">''</span>,</span><br><span class="line">  <span class="string">'detailRequest.bookingChannel'</span>: <span class="string">'1'</span>,</span><br><span class="line">  <span class="string">'detailRequest.cardNo'</span>: <span class="string">'192928'</span>,</span><br><span class="line">  <span class="string">'detailRequest.checkInDate'</span>: <span class="string">'2018-06-21'</span>,</span><br><span class="line">  <span class="string">'detailRequest.checkOutDate'</span>: <span class="string">'2018-06-22'</span>,</span><br><span class="line">  <span class="string">'detailRequest.cityId'</span>: <span class="string">'0101'</span>,</span><br><span class="line">  <span class="string">'detailRequest.customerLevel'</span>: <span class="string">'11'</span>,</span><br><span class="line">  <span class="string">'detailRequest.hotelIDs'</span>: <span class="string">'30101119'</span>,</span><br><span class="line">  <span class="string">'detailRequest.isAfterCouponPrice'</span>: <span class="string">'true'</span>,</span><br><span class="line">  <span class="string">'detailRequest.isDebug'</span>: <span class="string">'false'</span>,</span><br><span class="line">  <span class="string">'detailRequest.isLogin'</span>: <span class="string">'false'</span>,</span><br><span class="line">  <span class="string">'detailRequest.isMobileOnly'</span>: <span class="string">'false'</span>,</span><br><span class="line">  <span class="string">'detailRequest.isNeed5Discount'</span>: <span class="string">'false'</span>,</span><br><span class="line">  <span class="string">'detailRequest.isTrace'</span>: <span class="string">'false'</span>,</span><br><span class="line">  <span class="string">'detailRequest.language'</span>: <span class="string">'cn'</span>,</span><br><span class="line">  <span class="string">'detailRequest.needDataFromCache'</span>: <span class="string">'false'</span>,</span><br><span class="line">  <span class="string">'detailRequest.orderFromID'</span>: <span class="string">'50'</span>,</span><br><span class="line">  <span class="string">'detailRequest.payMethod'</span>: <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">'detailRequest.productType'</span>: <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">'detailRequest.promotionChannelCode'</span>: <span class="string">'0000'</span>,</span><br><span class="line">  <span class="string">'detailRequest.proxyID'</span>: <span class="string">'ZD'</span>,</span><br><span class="line">  <span class="string">'detailRequest.sellChannel'</span>: <span class="string">'1'</span>,</span><br><span class="line">  <span class="string">'detailRequest.settlementType'</span>: <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">'detailRequest.updateOrder'</span>: <span class="string">'false'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reqHeaders = &#123;</span><br><span class="line">    <span class="string">'Accept'</span>: <span class="string">'application/json, text/javascript, */*; q=0.01'</span>,</span><br><span class="line">    <span class="string">'Accept-Language'</span>: <span class="string">'zh-CN,zh;q=0.9,en;q=0.8,ja;q=0.7,zh-TW;q=0.6'</span>,</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded; charset=UTF-8'</span>,</span><br><span class="line">    <span class="string">'Host'</span>: <span class="string">'hotel.elong.com'</span>,</span><br><span class="line">    <span class="string">'Origin'</span>: <span class="string">'http://hotel.elong.com'</span>,</span><br><span class="line">    <span class="string">'Referer'</span>: <span class="string">'http://hotel.elong.com/beijing/'</span>,</span><br><span class="line">    <span class="string">'User-Agent'</span>:<span class="string">''</span> ,</span><br><span class="line">    <span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dealCookie</span><span class="params">(setCookieStr=<span class="string">''</span>)</span>:</span></span><br><span class="line">    setCookieStr = setCookieStr.strip()</span><br><span class="line">    setCookieStr = setCookieStr.split(<span class="string">';'</span>)[<span class="number">0</span>].strip()</span><br><span class="line">    cookieList = setCookieStr.split(<span class="string">'='</span>)</span><br><span class="line">    <span class="keyword">return</span> cookieList[<span class="number">0</span>].strip(), cookieList[<span class="number">1</span>].strip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line">cur = datetime.datetime.now() + datetime.timedelta(days=<span class="number">-1</span>)</span><br><span class="line">output = []</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 准备请求参数</span></span><br><span class="line">    count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    cur = cur + datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line">    next = cur + datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line">    curStr = cur.strftime(<span class="string">'%Y-%m-%d'</span>)</span><br><span class="line">    nextStr = next.strftime(<span class="string">'%Y-%m-%d'</span>)</span><br><span class="line">    ua = createUa()</span><br><span class="line">    print(curStr, nextStr)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">del</span> queryDict[<span class="string">'code'</span>]</span><br><span class="line">    queryDict[<span class="string">'detailRequest.checkInDate'</span>] = curStr</span><br><span class="line">    queryDict[<span class="string">'detailRequest.checkOutDate'</span>] = nextStr</span><br><span class="line">    queryDict[<span class="string">'detailRequest.hotelIDs'</span>] = HOTELID</span><br><span class="line"></span><br><span class="line">    reqHeaders[<span class="string">'User-Agent'</span>] = ua   <span class="comment"># 每次伪造一个ua，防止ua被封杀</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取加密的code</span></span><br><span class="line">    r1 =  requests.get(<span class="string">'http://hotel.elong.com/ajax/detail/getcode.html'</span>, params=queryDict, headers=reqHeaders)</span><br><span class="line">    <span class="keyword">if</span> r1.status_code != <span class="number">200</span>:</span><br><span class="line">        print(r1.status_code)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    r1Result = r1.json()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> r1Result[<span class="string">'success'</span>]:</span><br><span class="line">        print(r1.content)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    codeStr = r1Result[<span class="string">'value'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 把加密的code换城解密的code</span></span><br><span class="line">    postData = &#123;</span><br><span class="line">        <span class="string">'code'</span>:codeStr,</span><br><span class="line">        <span class="string">'hotelid'</span>:HOTELID,</span><br><span class="line">        <span class="string">'checkin'</span>:curStr,</span><br><span class="line">        <span class="string">'checkout'</span>:nextStr,</span><br><span class="line">    &#125;</span><br><span class="line">    r2 = requests.post(<span class="string">'http://127.0.0.1:3000/getelongcode'</span>,data = postData)</span><br><span class="line">    nodeCodeStr = r2.content</span><br><span class="line">    <span class="keyword">if</span> nodeCodeStr == <span class="string">'-99'</span>:</span><br><span class="line">        print(nodeCodeStr)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    queryDict[<span class="string">'code'</span>] = nodeCodeStr</span><br><span class="line"></span><br><span class="line">    setCookies = r1.headers[<span class="string">'Set-Cookie'</span>]</span><br><span class="line">    c =  Cookie.SimpleCookie()</span><br><span class="line">    c.load(setCookies)</span><br><span class="line">    jar = requests.cookies.RequestsCookieJar()</span><br><span class="line">    <span class="keyword">for</span> key, value <span class="keyword">in</span> c.items():</span><br><span class="line">        jar.set(key, value.value, domain=<span class="string">'hotel.elong.com'</span>, path=<span class="string">'/'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 抓取详细的房态价格</span></span><br><span class="line">    r3 =  requests.post(<span class="string">'http://hotel.elong.com/ajax/detail/gethotelroomsetjva'</span>,</span><br><span class="line">                        data = queryDict, headers=reqHeaders, cookies=jar)</span><br><span class="line"></span><br><span class="line">    result = r3.json()</span><br><span class="line">    contentStr = result[<span class="string">'value'</span>][<span class="string">'content'</span>].replace(<span class="string">'\n'</span>,<span class="string">' '</span>).replace(<span class="string">'\r'</span>,<span class="string">' '</span>)</span><br><span class="line"></span><br><span class="line">    obj = re.findall(<span class="string">r'&lt;span class="ht_pri_num"&gt;(\d+)&lt;/span&gt;'</span>, contentStr, flags=re.U)</span><br><span class="line"></span><br><span class="line">    md5Str = md5(contentStr)</span><br><span class="line"></span><br><span class="line">    print(md5Str)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> count &gt;= <span class="number">90</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    output.append(&#123;</span><br><span class="line">            <span class="string">'content:'</span>:<span class="string">','</span>.join(obj),</span><br><span class="line">            <span class="string">'inDate'</span>:curStr,</span><br><span class="line">            <span class="string">'outDate'</span>:nextStr,</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">trans(output, HOTELID)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'all done'</span>)</span><br></pre></td></tr></table></figure>
<p>至此，我们完全突破了x龙的防爬系统，关键的关键就是如何算出和浏览器端相同的<code>code</code>码，总结一下吧：</p>
<p>1、x龙的防爬系统比我预想的要复杂，在流程设计上还是花了心思的</p>
<p>2、<code>dynamicScript</code>的动态脚本的设计，比较巧妙，每次真实请求一次，都获取一次code，动态调整<code>dynamicScript</code>里面的内容，可以方便的修改规则，而不用前端修改代码，这样修改成本比较低，如果前端脚本运行里面的判断修改了<code>location.href</code>，比如改用了<code>canvas</code>这样的东西，就可以让我们的<code>node.js</code>脚本瞬间失效了。但是，我们可以利用seleium来动态的执行<code>js</code>来进行模拟浏览器环境的运行我们的破解脚本，所以流程不更改，我们再次破解也是很容易的。</p>
<p>3、经过我们这次的破解，x龙想要再换防爬的流程，成本还是比较高的，保守估计周期在3个月以上。</p>
<p>4、经过我们破解后，抓取60天的数据，只需要10几秒钟而已，大大提高了抓取效率哦，简单试了几次我们的伪造的<code>code</code>和真实请求的<code>code</code>是一摸一样的。</p>

        
      </div>
      
      
      
    </div>
    



    
    
    
  </div>


          </div>
          

  
    <div class="comments" id="comments">
      
        <div id="gitment-container"></div>
      
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">snoopyxdy</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">284</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">分类</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用seleium来直接抓取"><span class="nav-number">1.</span> <span class="nav-text">使用seleium来直接抓取</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#正面对抗，逆向x龙的防爬系统"><span class="nav-number">2.</span> <span class="nav-text">正面对抗，逆向x龙的防爬系统</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">snoopyxdy</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v6.5.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.5.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.5.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.5.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.5.0"></script>



  



  






<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="http://wzhfile.static.xytang88.com/gitmint.browser.js?v=1"></script>
    
<!-- END LOCAL -->

    
      <style>
        a.gitment-editor-footer-tip { display: none; }
        .gitment-container.gitment-footer-container { display: none; }
      </style>
    

    
      <script type="text/javascript">
      function renderGitment(){
        var gitment = new Gitmint({
            id: window.location.pathname,
            owner: 'DoubleSpout',
            repo: 'dsblog',
            
            lang: "" || navigator.language || navigator.systemLanguage || navigator.userLanguage,
            
            oauth: {
            
            
                client_secret: '202e5bcda8eacf79e44b6261326de2e79eff846e',
            
                client_id: '7d56dc5e01e83a1a44bb'
            }});
        gitment.render('gitment-container');
      }

      
      renderGitment();
      
      </script>
    






  





  

  

  

  

  

  
  

  

  

  

  

  

  

</body>
</html>
